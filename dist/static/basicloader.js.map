{"version":3,"file":"basicloader.js","mappings":"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","sources":["webpack://webpack-demo/./src/sys/bootloader_static.js","webpack://webpack-demo/./src/sys/bootsys.js","webpack://webpack-demo/./src/sys/modules/displaymodes.js","webpack://webpack-demo/./src/sys/modules/tablecon.js","webpack://webpack-demo/./src/sys/modules/canvas.js","webpack://webpack-demo/./src/sys/modules/simplewarning.js","webpack://webpack-demo/./src/sys/modules/privwarning.js","webpack://webpack-demo/./src/sys/modules/mutedinput.js","webpack://webpack-demo/./src/sys/modules/domelinput.js","webpack://webpack-demo/./src/sys/modules/htmlwrapper.js","webpack://webpack-demo/./src/sys/modules/basic/apps.js","webpack://webpack-demo/./src/sys/modules/sessionfs.js","webpack://webpack-demo/./src/sys/modules/lfs.js","webpack://webpack-demo/./src/sys/modules/ramfs.js","webpack://webpack-demo/./src/sys/modules/scripturl.js","webpack://webpack-demo/./src/sys/modules/qfs.js"],"sourcesContent":["const staticLoading = true;\n\nimport  BootSys   from        './bootsys.js';\n\nimport  displaymodes   from        './modules/displaymodes.js';\nimport  tablecon   from        './modules/tablecon.js';\nimport  canvas   from        './modules/canvas.js';\nimport  simplewarning  from   './modules/simplewarning.js';\nimport  privwarning from     './modules/privwarning.js';\nimport  mutedinput from      './modules/mutedinput.js';\nimport domelinput from      './modules/domelinput.js';\nimport htmlwrapper from     './modules/htmlwrapper.js';\nimport sessionfs  from       './modules/sessionfs.js';\nimport lfs  from             './modules/lfs.js';\nimport ramfs  from           './modules/ramfs.js';\nimport qfs  from             './modules/qfs.js';\nimport scripturl  from       './modules/scripturl.js';\nimport basic from           './modules/basic/apps.js';\n\nboot = new BootSys( staticLoading );\nvar sys = boot.getSys();\n\n\nboot.dep = {};\nboot.i = {}\nboot.i.displaymodes = displaymodes;\nboot.i.tablecon = tablecon;\nboot.i.canvas = canvas;\nboot.i.simplewarning = simplewarning;\nboot.i.priv = privwarning;\nboot.i.mutedinput = mutedinput;\nboot.i.domelinput = domelinput;\nboot.i.htmlwrapper = htmlwrapper;\nboot.i.basic = basic;\nboot.i.sfs = sessionfs\nboot.i.lfs = lfs;\nboot.i.ramfs = ramfs;\nboot.i.script = scripturl;\nboot.i.qfs = qfs;\nboot.dep.qfs = [ \"ramfs\", \"lfs\", \"sfs\", \"script\" ];\nboot.dep.basic = [ \"canvas\", \"tablecon\", \"displaymodes\", \"qfs\", \"htmlwrapper\" ];\n\nboot.initSimpleLogging();\n\n/* Instantiate modules */\nvar mods = Object.getOwnPropertyNames( boot.i );\n\nfor( var i=0;i<mods.length;i++) {\n  console.log(\"construct \" + mods[ i ] );\n  boot.m[ mods[i] ] = new boot.i[ mods[i] ]( sys, boot.dep[ mods[i] ] );\n}\n\n\n\nsys.init.queuedMessages = sys.nulcon;\nsys.init.conStyle = boot.conStyle;\nsys.init.displayMode = boot.displayMode;\nsys.m = boot.m;\n\nsys.m.displaymodes.setMode( boot.displayMode );\nvar con = sys.m.displaymodes.getDriver();\nboot.out = con;\nsys.out =  con;\n\n/* Initialize modules */\nfor( var i=0;i<mods.length;i++) {\n  console.log(\"init \" + mods[ i ] );\n  boot.m[ mods[i] ].init();\n}\n\n/* Get the boot script */\n\ntry {\n\n\n  var script = boot.rootScript.dataset.script;\n  if( script == null ) { script = \"autorun.bas\"; }\n  boot.onReady = \"script://\" + script;\n}\ncatch ( e ) {\n  alert( \"HALT: Boot-Onready Handler not found!!\");\n  throw \"HALT - Neither root-script-attribute 'basScript' or constant 'BOOT_ONREADY' defined.\";\n}\n\n\nsys.nulcon = undefined;\nboot.input = boot.m.domelinput;\nconsole.log( \"boot.basic=\",boot.basic );\nboot.m.basic.setInput( boot.input );\nboot.m.basic.loadApp(  boot.onReady );\n","class COMMONBOOTLOADER {\n\n  constructor( staticFlag ) {\n\n    var sys = {};\n    this.m = {};\n    sys.m = this.m;\n    this.sys = sys;\n    sys.init = {};\n    sys.staticTarget = staticFlag;\n\n    sys.domContainer = document.createElement(\"div\");\n    document.body.appendChild( sys.domContainer );\n\n    sys.SIG = \"boss64\";\n    sys.VERSION = \"0.1\";\n    sys.CODENAME = \"Papa Smurf\";\n\n    sys.nulcon = [];\n    sys.nulcon.push(\"Starting BOSS...\");\n    sys.nulcon.push(\"BOS version \" + sys.VERSION);\n    sys.nulcon.push(\"BOS signature \" + sys.SIG);\n    sys.nulcon.push(\"BOS release name \\\"\" + sys.CODENAME + \"\\\"\");\n    sys.nulcon.push(\"Starting Boot Sequence...\");\n\n\n    var rootScript = document.getElementById(\"boot\");\n    this.rootScript = rootScript;\n\n\n    this.displayMode = parseInt( rootScript.dataset.mode );\n\n    this.bootMode = rootScript.dataset.boot;\n\n    this.dynamicMinTarget = (this.bootMode.indexOf(\"min\") >= 0);\n    sys.dynamicMinTarget = this.dynamicMinTarget;\n\n    this.bootDebug = (this.bootMode.indexOf(\"debug\") >= 0);\n\n    if( this.bootDebug ) {\n      sys.nulcon.push(\"Enabled debug mode\");\n    }\n\n    if( this.dynamicMinTarget ) {\n      sys.nulcon.push(\"Enabled minimal target settings for dynamic mode\");\n    }\n\n    document.body.style.backgroundColor = \"#444444\";\n  }\n\n  getSys() {\n    return this.sys;\n  }\n\n  initSimpleLogging() {\n\n    /*primitive logging, before it is setup fully*/\n\n    var sys = this.sys;\n\n    sys.out = {\n      buf: \"\"\n    };\n\n    var out = sys.out;\n\n    sys.out.getAll = function() {\n      return out.buf;\n    }\n\n    sys.out.writeln = function( txt ) {\n      var s = \"$\" + txt +\"\\n\";\n      out.buf += s;\n      console.log( s );\n    }\n\n    out.writeln( \"$Init logging...\" );\n\n    sys.rawlog = function( type, array ) {\n\n      var line = array;\n      var txt = \"\";\n\n      txt +=  ( type + \": \" );\n\n      for( var j=0; j<line.length; j++) {\n          var sep = \" \";\n          if( j==0 ) { sep = \"\" };\n          txt += ( sep + line[j] );\n      }\n\n      sys.out.writeln( txt );\n\n    }\n\n    sys.rawlogcon = function( type, array ) {\n\n      var line = array;\n      var txt = \"\";\n\n      txt +=  ( type + \": \" );\n\n      for( var j=0; j<line.length; j++) {\n          var sep = \" \";\n          if( j==0 ) { sep = \"\" };\n          txt += ( sep + line[j] );\n      }\n\n      console.log( txt );\n\n    }\n\n    sys.log = function() {\n      var args = Array.prototype.slice.call(arguments);\n      sys.rawlog( \"info\", args );\n      console.log.apply(console, args);\n    }\n\n    sys.logwarn = function() {\n      var args = Array.prototype.slice.call(arguments);\n      sys.rawlog( \"warn\", args );\n      console.warn(args);\n    }\n\n    sys.logerr = function() {\n      var args = Array.prototype.slice.call(arguments);\n      sys.rawlog( \"error\", args );\n      console.error.apply(console, args);\n    }\n\n    this.logerr = sys.logerr;\n    this.logwarn = sys.logwarn;\n    this.log = sys.log;\n\n    if( !this.bootDebug ) {\n      sys.rawlog = sys.rawlogcon;\n    }\n  }\n\n\n}\n\nexport { COMMONBOOTLOADER as default};\n","class KERNALMODULE {\n\n\tconstructor( sys ) {\n\t\tthis.initialized = false;\n\t\tthis.default = 100;\n\n\t\tthis.sys = sys;\n\t\tthis.drivers = [];\n\n\t}\n\n\tinit() {\n\n\t\t\tif( this.initialized ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.drivers[\"text\"] = this.sys.m.tablecon;\n\t\t\tthis.drivers[\"canvas\"] = this.sys.m.canvas;\n\n\t\t\tthis.modes = [];\n\n\t\t\tvar textmode1 = \"text:80x30\";\n\t\t\tvar textmode2 = \"text:80x50\";\n\t\t\tvar textmode3 = \"text:120x50\";\n\t\t\tvar textmode4 = \"text:80x150\";\n\n\t\t\tvar fontSmall = \t\"font=14\";\n\t\t\tvar fontMedium1 = \"font=16\";\n\t\t\tvar fontMedium2 = \"font=18\";\n\t\t\tvar fontBig = \t\t\"font=22\";\n\n\t\t\tthis.modes[0] = textmode1 + \":\" + fontSmall;\n\t\t\tthis.modes[1] = textmode1 + \":\" + fontMedium1;\n\t\t\tthis.modes[2] = textmode1 + \":\" + fontMedium2;\n\t\t\tthis.modes[3] = textmode1 + \":\" + fontBig;\n\n\t\t\tthis.modes[4] = textmode2 + \":\" + fontSmall;\n\t\t\tthis.modes[5] = textmode2 + \":\" + fontMedium1;\n\t\t\tthis.modes[6] = textmode2 + \":\" + fontMedium2;\n\t\t\tthis.modes[7] = textmode2 + \":\" + fontBig;\n\n\t\t\tthis.modes[8] = textmode3 + \":\" + fontSmall;\n\t\t\tthis.modes[9] = textmode3 + \":\" + fontMedium1;\n\t\t\tthis.modes[10] = textmode3 + \":\" + fontMedium2;\n\t\t\tthis.modes[11] = textmode3 + \":\" + fontBig;\n\n\t\t\tthis.modes[12] = textmode4 + \":\" + fontSmall;\n\t\t\tthis.modes[13] = textmode4 + \":\" + fontMedium1;\n\t\t\tthis.modes[14] = textmode4 + \":\" + fontMedium2;\n\t\t\tthis.modes[15] = textmode4 + \":\" + fontBig;\n\n\t\t\tthis.modes[100] = \"canvas:1024x768\";\n\n\t\t\tthis.modes[200] = \"canvas:800x600\";\n\t\t\tthis.modes[201] = \"canvas:640x512\";\n\t\t\tthis.modes[202] = \"canvas:640x480\";\n\t\t\tthis.modes[203] = \"canvas:640x400\";\n\t\t\tthis.modes[204] = \"canvas:320x512\";\n\t\t\tthis.modes[205] = \"canvas:320x400\";\n\t\t\tthis.modes[206] = \"canvas:320x256\";\n\t\t\tthis.modes[207] = \"canvas:320x200\";\n\n\t}\n\n\tgetDriver() {\n\t\treturn this.currentDriver;\n\t}\n\n\tgetMode( x ) {\n\t\tthis.init();\n\n\t\tif( ! x ) {\n\t\t\treturn getMode( this.default );\n\t\t}\n\t\treturn this.modes[ x ];\n\t}\n\n\tsetMode( x ) {\n\t\tthis.init();\n\n\t\tif( x === undefined || x === null || x === -1 || Number.isNaN( x ) ) {\n\t\t\tthis.setMode( this.default );\n\t\t}\n\n\t\tvar dc = this.getDeviceConfig( x );\n\t\tif(! dc ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar cm = this.currentMode;\n\t\tif( ! (cm === undefined || cm === null || cm === -1 || Number.isNaN( x ) ) ) {\n\t\t\t\tthis.endMode( this.currentMode );\n\t\t}\n\n\t\tdc.device.initMode( dc.config );\n\t\tthis.currentMode = x;\n\t\tthis.currentDriver = dc.device;\n\n\t}\n\n\tendMode() {\n\n\t\tthis.init();\n\n\t\tif( !this.currentDriver ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar dev = this.currentDriver;\n\n\t\tdev.destroy();\n\t\tthis.currentMode = undefined;\n\t\tthis.currentDriver = undefined;\n\n\t}\n\n\tgetDeviceConfig( x ) {\n\n\t\tif( x === undefined || x === null || x === -1 || Number.isNaN( x ) ) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif( !this.modes[ x ] ) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tvar tmp = this.modes[ x ].split(\":\");\n\t\tif( tmp.length < 2 ) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tvar driver = tmp[0];\n\t\tif( !this.drivers[ driver ] ) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tvar driverDevice = this.drivers[ driver ];\n\n\t\tvar param = tmp.splice(1);\n\n\t\treturn {\n\t\t\tdevice: driverDevice,\n\t\t\tconfig: param\n\t\t};\n\n\t}\n\n}\n\nexport { KERNALMODULE as default};\n","class KERNALMODULE {\n\n\tconstructor( sys ) {\n\t\tthis.sys = sys;\n\t\tthis.cursorOn = false;\n\t\tthis.cols = 80;\n\t\tthis.rows = 30;\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\t\tthis.hidden = false;\n\t\tthis.blinking = true;\n\t\tthis.reverse = false;\n\n\t\tthis.outColors ={};\n\n\t\tthis.fontSizeInt = 18;\n\t\tthis.fontSizeCSS = this.fontSizeInt + \"px\";\n\t\tthis.fontFamily = \"monospace\";\n\n\n\t\tthis.colors = [\n\t\t\t\"#000000\",\n\t\t\t\"#ffffff\",\n\t\t\t\"#ee2222\",\n\t\t\t\"#22ee22\",\n\t\t\t\"#2222ee\",\n\t\t\t\"#eeee22\",\n\t\t\t\"#22eeee\",\n\t\t\t\"#ee22ee\",\n\t\t\t\"#aaaaaa\",\n\t\t\t\"#777777\",\n\t\t\t\"#444444\",\n\t\t\t\"#FFAC1C\",\n\t\t\t\"#5C3317\",\n\t\t\t\"#F88379\",\n\t\t\t\"#79F883\",\n\t\t\t\"#8379F8\"\n\n\t\t];\n\n\t\tthis.outColors.txtBgColor= this.colors[0];\n\t\tthis.outColors.txtColor = this.colors[5];\n\n\t}\n\n\n\tdestroy() {\n\t\t\tthis.outDiv0.remove();\n\t\t\tthis.cvs = null;\n\t\t\tthis.cvs2 = null;\n\t\t\tthis.ctx = null;\n\t\t\tthis.ctx2 = null;\n\n\t\t\tthis.rowel = undefined;\n\t\t\tthis.cellel = undefined;\n\n\t\t\tif( this.blinkInterval ) {\n\t\t\t\tclearInterval ( this.blinkInterval );\n\t\t\t\tthis.blinkInterval = undefined;\n\t\t\t}\n\t\t}\n\n\t\tinit() {\n\t\t}\n\n\t\tgetColumCount() {\n\t\t\treturn this.cols;\n\t\t}\n\n\t\tgetRowCount() {\n\t\t\treturn this.rows;\n\t\t}\n\n\t\tgetDimensions() {\n\t\t\t\treturn [this.cols, this.rows ];\n\t\t}\n\n\t\tinitMode( m ) {\n\n\t\t\tvar sys = this.sys;\n\t\t\tvar msgs = sys.init.queuedMessages;\n\n\t\t\tsys.init.inputElement = document.body;\n\n\t\t\tthis.x = 0;\n\t\t\tthis.y = 0;\n\t\t\tthis.blinking = true;\n\n\t\t\tvar tmp = m[0].split(\"x\");\n\t\t\tif( tmp.length == 2) {\n\t\t\t\tthis.rows = parseInt( tmp[1] );\n\t\t\t\tthis.cols = parseInt( tmp[0] );\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttmp = m[1].split(\"=\");\n\t\t\tif( tmp.length == 2) {\n\n\t\t\t\tthis.fontSizeInt = parseInt( tmp[1] );\n\t\t\t\tthis.fontSizeCSS = this.fontSizeInt + \"px\";\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.colsPercentage = (1/this.cols) * 100;\n\t\t\tthis.outColors.txtBgColor = this.colors[ 4 ];\n\t\t\tthis.outColors.txtColor = this.colors[ 1 ];\n\n\t\t\t/* Build DOM */\n\n\t\t\tthis.outDiv0 = document.createElement(\"div\");\n\t\t\tthis.outDiv1 = document.createElement(\"div\");\n\n\t\t\tthis.outEl = document.createElement(\"table\");\n\t\t\tthis.outEl.value = \"\";\n\n\t\t\tfunction getTextOfSelection () {\n\t\t\t  var range;\n\t\t\t  if (document.selection && document.selection.createRange) {\n\t\t\t    range = document.selection.createRange();\n\t\t\t    return range.toString();\n\t\t\t  }\n\t\t\t  else if (window.getSelection) {\n\t\t\t    var selection = window.getSelection();\n\t\t\t    if (selection.rangeCount > 0) {\n\t\t\t      range = selection.getRangeAt(0);\n\t\t\t\t\t\tconst documentFragment = range.cloneContents();\n\n\t\t\t\t\t\tvar rows = documentFragment.childNodes;\n\t\t\t\t\t\tvar text = \"\";\n\t\t\t\t\t\tfor( var rix=0; rix< rows.length ; rix++ ) {\n\t\t\t\t\t\t\tvar r = rows[rix];\n\t\t\t\t\t\t\tif( text != \"\" ) {\n\t\t\t\t\t\t\t\ttext += \"\\n\";\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar cols = r.childNodes;\n\t\t\t\t\t\t\tfor( var cix=0; cix< cols.length ; cix++ ) {\n\t\t\t\t\t\t\t\tvar c = cols[cix];\n\t\t\t\t\t\t\t\ttext += c.firstChild.data;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn text;\n\t\t\t    }\n\t\t\t    else {\n\t\t\t      return '';\n\t\t\t    }\n\t\t\t  }\n\t\t\t  else {\n\t\t\t    return '';\n\t\t\t  }\n\t\t\t}\n\n\t\t\tvar __this = this;\n\n\t\t\tthis.outDiv0.addEventListener('copy', (event) => {\n\n\t\t\t\tvar sel = getTextOfSelection();\n\n\t\t\t\tevent.clipboardData.setData(\"text/plain\", sel );\n\t\t\t  event.preventDefault();\n\n\t\t\t});\n\n\t\t\tthis.table =  this.outEl;\n\t\t\tthis.table.style.borderCollapse = \"collapse\";\n\t\t\tthis.table.style.borderSpacing = 0;\n\t\t\tthis.table.style.backgroundColor = this.outColors.txtBgColor;\n\n\t\t\tthis.table.style.resize = \"none\";\n\t\t\tthis.table.style.fontFamily = this.fontFamily;\n\t\t\tthis.table.style.fontSize = this.fontSizeCSS;\n\t\t\tthis.table.style.tableLayout = \"fixed\";\n\t\t\tthis.table.readOnly = true;\n\t\t\tthis.table.textAlign = \"center\";\n\n\t\t\tthis.rowel = [];\n\t\t\tthis.cellel = [];\n\n\t\t\tfor( var y=0; y<this.rows; y++) {\n\t\t\t\tvar tr =  document.createElement(\"tr\");\n\t\t\t\ttr.style.padding = \"0px\";\n\t\t\t\ttr.style.maxHeight = this.fontSizeInt;\n\t\t\t\ttr.style.height = this.fontSizeInt;\n\n\t\t\t\tthis.rowel.push( tr );\n\t\t\t\tthis.outEl.appendChild( tr );\n\t\t\t\tvar rowArray = [];\n\t\t\t\tfor( var x=0; x<this.cols; x++) {\n\t\t\t\t\tvar td =  document.createElement(\"td\");\n\t\t\t\t\t//td.style.width = this.colsPercentage + \"%\";\n\t\t\t\t\t//td.style.overflow = \"hidden\";\n\t\t\t\t\t//console.log( td.style.width );\n\t\t\t\t\ttd.style.padding = \"0px\";\n\t\t\t\t\ttd.style.color = this.outColors.txtColor;\n\t\t\t\t\ttd.style.backgroundColor = undefined;\n\t\t\t\t\ttd.style.textOverflow = \"\";\n\t\t\t\t\ttd.style.whiteSpace= \"nowrap\";\n\t\t\t\t\ttd.style.overflow = \"hidden\";\n\t\t\t\t\ttd.style.maxWidth = this.fontSizeInt;\n\t\t\t\t\ttd.style.maxHeight = this.fontSizeInt;\n\t\t\t\t\t//td.style.width = this.fontSize;\n\t\t\t\t\ttd.style.height = this.fontSizeInt;\n\n\t\t\t\t\ttd.innerHTML = \"&nbsp;\";\n\n\t\t\t\t\trowArray.push( td );\n\t\t\t\t\ttr.appendChild( td );\n\t\t\t\t}\n\t\t\t\tthis.cellel.push( rowArray );\n\t\t\t}\n\n\n\t\t\tdocument.body.appendChild( this.outDiv0 );\n\n\t\t\tthis.outDiv0.style.display = \"table\";\n\t\t\tthis.outDiv0.style.width = \"99%\";\n\t\t\tthis.outDiv0.style.height = \"99%\";\n\t\t\tthis.outDiv0.style.position = \"absolute\";\n\t\t\tthis.outDiv0.style.zIndex = \"10000\";\n\n\t\t\tthis.outDiv1.style.display = \"table-cell\";\n\t\t\tthis.outDiv1.style.verticalAlign = \"middle\";\n\n\t\t\tthis.table.style.marginLeft = \"auto\";\n\t\t\tthis.table.style.marginRight = \"auto\";\n\n\t\t\tthis.outDiv0.appendChild( this.outDiv1 );\n\t\t\tthis.outDiv1.appendChild( this.outEl );\n\n\t\t\tthis.outEl.focus( );\n\n\t\t\t this.dirty = true;\n\t\t\t this.dirtyFlags = {\n\t\t\t\t bg: true,\n\t\t\t\t color: true\n\t\t\t }\n\n\t\t\tvar _this = this;\n\t\t\tthis.blinkInterval = \t setInterval(function()  {\n\t\t\t\t \t_this._int_blink();\n\t\t\t\t}, 500);\n\n\t\t\t\tfor( var i=0; i<msgs.length; i++) {\n\t\t\t\t\tthis.writeln( msgs[ i ]);\n\t\t\t\t}\n\n\t\t\t this.sys.log(\"TBCON Ready.\");\n\t}\n\n\tnative( operation ) {\n\t\tthrow \"@Operation \" + operation.action + \" not supported on TABLECON\";\n\t}\n\n\tblinkMode( mode ) {\n\t\tthis.blinking = mode;\n\t}\n\n\thasPixels() {\n\t\treturn false;\n\t}\n\n\t_int_updateArea( srccells, x0, y0, x1, y1 ) {\n\n\n\t\tfor( var x=x0; x<=x1; x++) {\n\t\t\tfor( var y=y0; y<=y1; y++) {\n\t\t\t\tvar cell = this.cellel[ y ][ x ];\n\t\t\t\tvar src = srccells[ y-y0 ][ x-x0 ];\n\n\t\t\t\tif( src.txt == \" \") {\n\t\t\t\t\t\tcell.innerHTML = \"&nbsp;\";\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t\tcell.textContent = src.txt;\n\t\t\t\t}\n\t\t\t\tcell.style.color =  this.colors[ src.fg ];\n\t\t\t\tcell.style.backgroundColor = this.colors[ src.bg ];\n\n\t\t\t}\n\t\t}\n\n\t}\n\n\tupdate( p, list ) {\n\n\t\tthis._int_blinkOff();\n\t\tthis.show();\n\n\t\tthis.x = p.cx;\n\t\tthis.y = p.cy;\n\t\tif(\n\t\t\tthis.x<0 || this.y<0 ||\n\t\t\tthis.x>= this.cols || this.y>= this.rows\n\t\t) {\n\t\t\tconsole.log(\"ouch\");\n\n\t\t}\n\n\t\tthis.outColors.txtBgColor= this.colors[ p.bg ];\n\t\tthis.outColors.txtColor = this.colors[ \tp.fg];\n\n\t\tfor( var i=0; i< list.length; i++) {\n\n\t\t\tvar el = list[ i ];\n\t\t\tthis._int_updateArea( el.cells, el.x1, el.y1, el.x2, el.y2 );\n\n\t\t}\n\n\n\t}\n\n\tupdateAll( p, srccells ) {\n\n\t\tthis._int_blinkOff();\n\t\tthis.show();\n\n\t\tthis.x = p.cx;\n\t\tthis.y = p.cy;\n\n\t\tif(\n\t\t\tthis.x<0 || this.y<0 ||\n\t\t\tthis.x>= this.cols || this.y>= this.rows\n\t\t) {\n\t\t\tconsole.log(\"ouch\");\n\n\t\t}\n\t\tthis.outColors.txtBgColor= this.colors[ p.bg ];\n\t\tthis.outColors.txtColor = this.colors[ \tp.fg];\n\n\t\tthis._int_updateArea( srccells, 0,0, this.cols -1, this.rows -1 );\n\n\t}\n\n\n\thide() {\n\t\tif( !this.hidden ) {\n\t\t\tthis.outDiv0.hidden = true;\n\t\t\tthis.hidden = true;\n\t\t}\n\t}\n\n\tshow() {\n\t\tif( this.hidden ) {\n\t\t\tthis.outDiv0.hidden = false;\n\t\t\tthis.hidden = false;\n\t\t}\n\t}\n\n\n\tgetElement() {\n\t\treturn null;\n\t}\n\n\n\t_int_blinkOff() {\n\n\t\tif( !this.cursorOn ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.cursorOn = false;\n\n\t\tvar cell = this.cellel[ this.y ][ this.x ];\n\n\t\tif( cell == null ) {\n\t\t\tconsole.log( \"cell at \" + this.x + \",\" + this.y +\" == null \");\n\t\t\treturn;\n\t\t}\n\n\t\tcell.style.color = this.outColors.txtColor;\n\t\tcell.style.backgroundColor = this.outColors.txtBgColor;\n\n\n\t}\n\n\t_int_blink() {\n\n\t\tif( ! this.blinking ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar cell;\n\t\ttry {\n\t\t\t\tcell = this.cellel[ this.y ][ this.x ];\n\t\t}\n\t\tcatch {\n\t\t\tcell = null;\n\t\t}\n\n\t\tif( cell == null ) {\n\t\t\tconsole.log( \"Blink exception: Cell at \" + this.x + \",\" + this.y +\" == null \");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.cursorOn = !this.cursorOn;\n\n\t\tif( !this.cursorOn ) {\n\t\t\tcell.style.color = this.outColors.txtColor;\n\t\t\tcell.style.backgroundColor = this.outColors.txtBgColor;\n\t\t}\n\t\telse {\n\t\t\tcell.style.backgroundColor = this.outColors.txtColor;\n\t\t\tcell.style.color = this.outColors.txtBgColor;\n\t\t}\n\t}\n\n\tclear() {\n\t\tthis._int_blinkOff();\n\t\tthis.show();\n\n\t\tfor( var x=0; x<this.cols; x++) {\n\t\t\tfor( var y=0; y<this.rows; y++) {\n\t\t\t\tvar cell = this.cellel[ y ][ x ];\n\t\t\t\tcell.innerHTML = \"&nbsp;\";\n\t\t\t\tcell.style.color = this.outColors.txtColor;\n\t\t\t\tcell.style.backgroundColor = this.outColors.txtBgColor;\n\n\t\t\t}\n\t\t}\n\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\t}\n\n\t__int_nl() {\n\t\t\tthis.x = 0;\n\t\t\tthis.y ++;\n\t\t\tif( this.y >= this.rows ) {\n\t\t\t\tthis.__int_scrollDown();\n\t\t\t\tthis.y = this.rows -1;\n\t\t\t}\n\n\t}\n\n\n\twriteln( str ) {\n\t\t\tthis._int_blinkOff();\n\t\t\tthis.show();\n\t\t\t//console.log( \"writeln\" + str );\n\n\t\t\tfor( var i=0; i<str.length; i++) {\n\t\t\t\tvar c = str.substr(i,1);\n\t\t\t\tthis.__int_write_direct_ch( c );\n\t\t\t}\n\t\t\tthis.__int_nl();\n\t}\n\n\n\t__int_write_direct_ch( ch ) {\n\n\t\tvar cell = this.cellel[ this.y ][ this.x ];\n\n\t\tif( cell == null ) {\n\t\t\tconsole.log( \"cell at \" + this.x + \",\" + this.y +\" == null \");\n\t\t\treturn;\n\t\t}\n\n\t\tif( ch == \" \") {\n\t\t\t\tcell.innerHTML = \"&nbsp\";\n\t\t}\n\t\telse {\n\t\t\tcell.innerHTML = ch;\n\t\t}\n\n\t\tif( !this.reverse  ) {\n\t\t\tcell.style.color = this.outColors.txtColor;\n\t\t\tcell.style.backgroundColor = undefined;\n\t\t}\n\t\telse {\n\t\t\tcell.style.backgroundColor = this.outColors.txtColor;\n\t\t\tcell.style.color = this.outColors.txtBgColor;\n\t\t}\n\n\t\tthis.x++;\n\t\tif( this.x >= this.cols ) {\n\t\t\tthis.x = 0;\n\t\t\tthis.__int_nl();\n\t\t}\n\t}\n\n\n\n\t__int_scrollDown() {\n\t\tfor( var x=0; x<this.cols; x++) {\n\t\t\tfor( var y=0; y<this.rows-1; y++) {\n\t\t\t\tvar cell = this.cellel[ y ][ x ];\n\t\t\t\tvar cellyp1 = this.cellel[ y+1 ][ x ];\n\n\t\t\t\tcell.textContent = cellyp1.textContent;\n\t\t\t\tcell.style.color = cellyp1.style.color;\n\t\t\t\tcell.style.backgroundColor = cellyp1.style.backgroundColor;\n\n\n\t\t\t}\n\t\t}\n\n\t\tvar y2 = this.rows-1;\n\t\tfor( var x=0; x<this.cols; x++) {\n\t\t\tvar cell = this.cellel[ y2 ][ x ];\n\t\t\tcell.innerHTML = \"&nbsp;\";\n\t\t\tif( !this.reverse  ) {\n\t\t\t\tcell.style.color = this.outColors.txtColor;\n\t\t\t\tcell.style.backgroundColor = undefined;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcell.style.backgroundColor = this.outColors.txtColor;\n\t\t\t\tcell.style.color = \"rgba(0,255,0,0.0)\";\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { KERNALMODULE as default};\n","class KERNALMODULE {\n\n\t//TODO, keep colors somewhere, so multi colored text can be done\n\t//with update, and scroll\n\n\tconstructor( sys ) {\n\t\tthis.sys = sys;\n\t\tthis.cursorOn = false;\n\t\tthis.hidden = false;\n\t\tthis.blinking = true;\n\t\tthis.reverse = false;\n\n\t\tthis.colors ={};\n\n\t\tthis.palette = [\n\t\t\t\"#000000\",\n\t\t\t\"#ffffff\",\n\t\t\t\"#ee2222\",\n\t\t\t\"#22ee22\",\n\t\t\t\"#2222ee\",\n\t\t\t\"#eeee22\",\n\t\t\t\"#22eeee\",\n\t\t\t\"#ee22ee\",\n\t\t\t\"#aaaaaa\",\n\t\t\t\"#777777\",\n\t\t\t\"#444444\",\n\t\t\t\"#FFAC1C\",\n\t\t\t\"#5C3317\",\n\t\t\t\"#F88379\",\n\t\t\t\"#79F883\",\n\t\t\t\"#8379F8\"\n\n\t\t];\n\n\t\tthis.bmPalette = [];\n\t\tfor( var i=0; i<this.palette.length; i++) {\n\t\t\tvar htmlCol = this.palette[i];\n\t\t\tvar r = parseInt(htmlCol.substr(1,2),16)\n\t\t\tvar g = parseInt(htmlCol.substr(3,2),16)\n\t\t\tvar b = parseInt(htmlCol.substr(5,2),16)\n\t\t\tthis.bmPalette.push(\n\t\t\t\t{\n\t\t\t\t\tr:r,g:g,b:b\n\t\t\t\t}\n\t\t\t)\n\t\t}\n\n\t\tthis.defaultTextMode();\n\n\n\t}\n\n\n\tdestroy() {\n\t\tthis.outDiv0.remove();\n\t\tthis.cvs = null;\n\t\tthis.cvs2 = null;\n\t\tthis.cvs3 = null;\n\t\tthis.ctx = null;\n\t\tthis.ctx2 = null;\n\t\tthis.ctx3 = null;\n\t\tthis.cache = null;\n\n\t\tthis.cells = [];\n\n\t\tif( this.blinkInterval ) {\n\t\t\tclearInterval ( this.blinkInterval );\n\t\t\tthis.blinkInterval = undefined;\n\t\t}\n\t}\n\n\tdefaultTextMode() {\n\t\tthis.cols = 80;\n\t\tthis.rows = 30;\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\n\t\tthis.fontSize = \"18\";\n\n\t\tthis.fontSizeCSS = this.fontSize + \"px\";\n\t\tthis.fontSizeInt = parseInt( this.fontSize );\n\t\tthis.fontFamily = \"monospace\";\n\n\t\tvar oc = this.colors;\n\t\toc.bg = 0;\n\t\toc.fg = 5;\n\n\t\tthis.colors.bgHTML = this.palette[ oc.bg ];\n\t\tthis.colors.fgHTML = this.palette[ oc.fg ];\n\n\t}\n\n\tinit() {\n\t}\n\n\tinitMode( config ) {\n\n\t\t\tvar sys = this.sys;\n\t\t\tvar msgs = sys.init.queuedMessages;\n\n\t\t\tthis.cursorOn = false;\n\t\t\tthis.blinking = true;\n\t\t\tthis.reverse = false;\n\t\t\tthis.cursorMode = 1;\n\n\t\t\tvar tmp = config[0].split(\"x\");\n\t\t\tvar w = parseInt( tmp[0] );\n\t\t\tvar h = parseInt( tmp[1] );\n\n\t\t\tthis.cols = Math.floor( w / this.fontSizeInt );\n\t\t\tthis.rows = Math.floor( h / this.fontSizeInt );\n\n\t\t\t/* adjust w,h to fit exactly so many cols and rows */\n\t\t\tw = this.cols * this.fontSizeInt;\n\t\t\th = this.rows * this.fontSizeInt;\n\n\t\t\tthis.width = w;\n\t\t\tthis.height = h;\n\n\t\t\tconsole.log(\"Reinit with \" , w, h);\n\t\t\tconsole.log(\" colsXrows \" , this.cols, this.rows);\n\t\t\tthis.x = 0;\n\t\t\tthis.y = 0;\n\t\t\tthis.blinking = true;\n\n\t\t\tvar oc = this.colors;\n\t\t\toc.bg = 0;\n\t\t\toc.fg = 5;\n\t\t\toc.bgHTML = this.palette[ oc.bg ];\n\t\t\toc.fgHTML = this.palette[ oc.fg ];\n\n\t\t\tsys.init.inputElement = document.body;\n\n\t\t\tthis.outDiv0 = document.createElement(\"div\");\n\t\t\tthis.outDiv1 = document.createElement(\"div\");\n\t\t\tthis.center = document.createElement(\"center\");\n\n\t\t\tthis.cvs = document.createElement(\"canvas\");\n\t\t\tthis.ctx = this.cvs.getContext('2d', {alpha: false});\n\t\t\tthis.ctx.strokeStyle = '#ffffff';\n\t\t\tthis.cX = 0;\n\t\t\tthis.cY = 0;\n\t\t\t//this.cvs = this.outEl;\n\n\t\t\tthis.cvs2 = document.createElement(\"canvas\");\n\t\t\tthis.ctx2 = this.cvs2.getContext('2d');\n\n\t\t\tthis.cvs3 = document.createElement(\"canvas\");\n\t\t\tthis.ctx3 = this.cvs3.getContext('2d');\n\n\t\t\tthis.cache = [];\n\t\t\tthis.updCtxImageData = { synched: false }\n\n\t\t\tthis.cvs.width = w;\n\t\t\tthis.cvs.height = h;\n\t\t\tthis.cvs2.width = w;\n\t\t\tthis.cvs2.height = h;\n\n\t\t\tvar fs = this.fontSizeInt;\n\t\t\tthis.cvs3.width = fs;\n\t\t\tthis.cvs3.height = fs;\n\n\t\t\tthis.offsets = [];\n\n\t\t\tvar ctx = this.ctx;\n  \t\tctx.font =  this.fontSizeCSS + \" \" + this.fontFamily;\n \t\t  ctx.textBaseline = \"bottom\";\n\n\t\t\tvar str = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234567890@+_!#%&/()=?*-:;,.'\\\"\";\n\t\t\tvar fsid2 = this.fontSizeInt / 2;\n\t\t\tfor (const c of str) {\n\t\t\t\tvar tmp3 =  this.ctx.measureText( c )  ;\n\t\t\t\tvar tmp2 =  tmp3.width  ;\n\t\t\t\tvar tmp1 =  (tmp2 / 2) ;\n\t\t\t\tvar tmp0 =  fsid2 - tmp1 ;\n\t\t\t\tvar tmp = Math.floor( tmp0 );\n\t\t\t\tthis.offsets[ c ] = tmp;\n \t\t }\n\n\t\t\tthis.cells = [];\n\n\t\t\tvar cols = this.colors;\n\n\t\t\tfor( var y=0; y<this.rows; y++) {\n\t\t\t\tvar rowArray = [];\n\t\t\t\tfor( var x=0; x<this.cols; x++) {\n\t\t\t\t\trowArray.push( { txt: \" \", fg: cols.fg, bg: cols.bg } );\n\t\t\t\t}\n\t\t\t\tthis.cells.push( rowArray );\n\t\t\t}\n\n\t\t\tdocument.body.appendChild( this.outDiv0 );\n\n\t\t\tthis.outDiv0.style.display = \"table\";\n\t\t\tthis.outDiv0.style.width = \"99%\";\n\t\t\tthis.outDiv0.style.height = \"99%\";\n\t\t\tthis.outDiv0.style.position = \"absolute\";\n\t\t\tthis.outDiv0.style.zIndex = \"10000\";\n\n\t\t\tthis.outDiv1.style.display = \"table-cell\";\n\t\t\tthis.outDiv1.style.verticalAlign = \"middle\";\n\n\t\t\tthis.cvs.style.marginLeft = \"auto\";\n\t\t\tthis.cvs.style.marginRight = \"auto\";\n\n\t\t\tthis.outDiv0.appendChild( this.outDiv1 );\n\t\t\tthis.outDiv1.appendChild( this.center );\n\t\t\tthis.center.appendChild( this.cvs );\n\n\n\t\t\tthis.cvs.focus( );\n\n\n \t\t  var _this = this;\n\n\t\t\tthis.blinkInterval = setInterval(function()  {\n\n\t\t\t\t \t_this._int_blink();\n\t\t\t\t}, 300);\n\n\t\t\t\tfor( var i=0; i<msgs.length; i++) {\n\t\t\t\t\tthis.writeln( msgs[ i ]);\n\t\t\t\t}\n\n\t\t\t this.clear();\n\n\n\t\t\t this.sys.log(\"CANVASCON Ready.\");\n\t}\n\n\thide() {\n\t\tthis.init();\n\t\tif( !this.hidden ) {\n\t\t\tthis.outDiv0.hidden = true;\n\t\t\tthis.hidden = true;\n\t\t}\n\t}\n\n\tshow() {\n\t\tthis.init();\n\t\tif( this.hidden ) {\n\t\t\tthis.outDiv0.hidden = false;\n\t\t\tthis.hidden = false;\n\t\t}\n\t}\n\n\n\tgetElement() {\n\t\treturn null;\n\t}\n\n\n\tblinkMode( mode ) {\n\t\tthis.blinking = mode;\n\t}\n\n\n\t_int_blinkOff() {\n\n\n\t\tif( !this.cursorOn ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar fs = this.fontSizeInt;\n\n\t\tvar x0 = (fs * this.x);\n\t\tvar y0 = fs * (this.y );\n\n\t\tvar ctx = this.ctx;\n\n\t\tthis.ctx.drawImage(this.cvs3, x0, y0);\n\n\t\tthis.cursorOn = false;\n\n\t}\n\n\t_int_storeset_color( fg, bg ) {\n\n\t\tthis.oldfg = fg;\n\t\tthis.oldbg = bg;\n\n\t\tvar oc = this.colors;\n\t\toc.fg = fg;\n\t\toc.bg = bg;\n\t\toc.fgHTML = this.palette[ oc.fg ];\n\t\toc.bgHTML = this.palette[ oc.bg ];\n\n\t}\n\n\n\t_int_restore_color() {\n\n\t\tvar oc = this.colors;\n\t\toc.fg = this.oldfg;\n\t\toc.bg = this.oldbg;\n\t\toc.fgHTML = this.palette[ oc.fg ];\n\t\toc.bgHTML = this.palette[ oc.bg ];\n\n\t}\n\n\t_int_blink() {\n\n\t\tif( ! this.blinking ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar currentCursorIsOn = this.cursorOn;\n\n\t\tthis.cursorOn = !this.cursorOn;\n\n\t\tvar fs = this.fontSizeInt;\n\n\t\tvar x0 = (fs * this.x);\n\t\tvar y0 = fs * (this.y );\n\t\tvar oc = this.colors;\n\n\t\tvar ctx = this.ctx;\n\t\tvar cell = this.cells[ this.y][this.x ];\n\n\t\tif(  this.cursorOn ) {\n\n\t\t\t\t//ctx.filter = 'contrast(1.4) sepia(1) drop-shadow(-9px 9px 3px #e81)';\n\n\t\t\t\t/* first we backup underneath cursor */\n\t\t\t\tthis.ctx3.drawImage(this.cvs, x0, y0, fs, fs, 0, 0, fs, fs);\n\n\t\t\t\t/* we decide the colors */\n\t\t\t\tvar col = this.colors.fgHTML;\n\t\t\t\tvar index = this.colors.fg;\n\t\t\t\tvar index2 = this.colors.bg;\n\n\t\t\t\t/*if cell.bg == cell.fg, use instead black on white or white on black */\n\t\t\t\tif( cell.fg == cell.bg ) {\n\t\t\t\t\tif( cell.fg == 0 ) {\n\t\t\t\t\t\tindex = 1;\n\t\t\t\t\t\tindex2 = 0;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tindex = 0;\n\t\t\t\t\t\tindex2 = 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t/*if bg!=fg use cell colors*/\n\t\t\t\t\tindex = cell.fg;\n\t\t\t\t\tindex2 = cell.bg;\n\t\t\t\t}\n\n\t\t\t\tthis.paintCursor( x0, y0, cell.txt, index, index2, this.cursorMode );\n\n\t\t\t\treturn;\n\n\t\t}\n\t\telse {\n\n\t\t\t//cursor off\n\t\t\tthis.ctx.drawImage(this.cvs3, x0, y0);\n\n\t\t}\n\n\t}\n\n\t_int_updateArea( srccells, x0, y0, x1, y1 ) {\n\n\t\tvar ctx = this.ctx;\n\t\tvar fs = this.fontSizeInt;\n\t\tvar oc = this.colors;\n\n\t\tvar x; var y;\n\t\ttry {\n\t\tfor( x=x0; x<=x1; x++) {\n\t\t\tfor( y=y0; y<=y1; y++) {\n\t\t\t\tvar cell = this.cells[ y ][ x ];\n\t\t\t\tvar src = srccells[ y-y0 ][ x-x0 ];\n\t\t\t\tvar ch = src.txt;\n\n\t\t\t\toc.bg = src.bg;\n\t\t\t\toc.fg = src.fg;\n\n\t\t\t\toc.bgHTML = this.palette[ src.bg ];\n\t\t\t\toc.fgHTML = this.palette[ src.fg ];\n\n\t\t\t\tcell.txt = ch;\n\t\t\t\tcell.fg = src.fg;\n\t\t\t\tcell.bg = src.bg;\n\n\n\t\t\t\tthis.paintchar( fs * x , fs * y , ch );\n\t\t\t}\n\t\t}\n\t} catch ( e ) {\n\t\tconsole.log(\"x= \" + x + \" y= \" + y);\n\t\tconsole.log(\"x0=\", x0, \"y0=\",y0, \"x1=\",x1,\"y1=\",y1);\n\t\tconsole.log(e);\n\t}\n\n\t}\n\n\tpaintCursor( x, y, ch , col1, col2, mode ) {\n\t\tthis._int_storeset_color( col2, col1 );\n\t\tthis.paintchar( x, y, ch );\n\t\tthis._int_restore_color();\n\t}\n\n\tpaintchar( x, y, ch ) {\n\t\t\tthis.updCtxImageData.synched = false;\n\n\t\t\tvar oc = this.colors;\n\t\t\tvar index = ch + \":\"+oc.bg+\":\"+oc.fg;\n\t\t\tthis.reverse\n\t\t\tvar cacheel = this.cache[ index ];\n\t\t\tvar fs = this.fontSizeInt;\n\n\t\t\tif( ! cacheel ) {\n\n\t\t\t\tvar cvs = document.createElement(\"canvas\");\n\t\t\t\tvar ctx = cvs.getContext('2d', {alpha: false});\n\t\t\t\tcvs.width = fs;\n\t\t\t\tcvs.height = fs;\n\n\t\t\t\tctx.font =  this.fontSizeCSS + \" \" + this.fontFamily;\n\t\t\t\tctx.textBaseline = \"top\";\n\n\t\t\t\tvar off = 0;\n\t\t\t\tif( this.offsets[ ch ] ) {\n\t\t\t\t\toff = this.offsets[ ch ];\n\t\t\t\t}\n\n\t\t\t\tctx.fillStyle = this.colors.bgHTML\n\t\t\t\tctx.fillRect(  0,0, fs, fs);\n\n\t\t\t\tctx.fillStyle = this.colors.fgHTML;\n\t\t\t\tctx.fillText( ch , off, 0);\n\n\t\t\t\t//TODO what about all reverse's\n\n\t\t\t\tthis.cache[ index ] = { ctx: ctx, cvs: cvs } ;\n\t\t\t\tcacheel = this.cache[ index ];\n\n\t\t\t}\n\n\t\t\tif( ch != \" \" )  {\n\t\t\t\tvar tmp = 1;\n\t\t\t}\n\n\t\t\t//if( cacheel.cvs != null ) {\n\t\t\t\t\tthis.ctx.drawImage( cacheel.cvs, x, y);\n\t\t\t//}\n\n\t\t}\n\n\t\top_gcolor( params ) {\n\t\t\t\tvar htmlCol = this.palette[ params.c ];\n\t\t\t\tvar ctx = this.ctx;\n\t\t\t\tctx.strokeStyle = htmlCol;\n\n\t\t}\n\n\n\t\top_line( params ) {\n\n\t\t\tthis.updCtxImageData.synched = false;\n\n\t\t\tvar ctx = this.ctx;\n\n\t\t\tvar x0 =params.x0;\n\t\t\tvar y0 =params.y0;\n\t\t\tif( x0 < 0) {\n\t\t\t\tx0=this.cX;\n\t\t\t}\n\t\t\tif( y0 < 0) {\n\t\t\t\ty0=this.cY;\n\t\t\t}\n\n\t\t\tctx.beginPath(); // Start a new path\n\t\t\tctx.moveTo( x0,  y0); // Move the pen to (30, 50)\n\t\t\tctx.lineTo(params.x1, params.y1); // Draw a line to (150, 100)\n\t\t\tctx.stroke(); // Render the path\n\n\t\t\tthis.cX = params.x1;\n\t\t\tthis.cY = params.y1;\n\n\t\t}\n\n\t\tnative( operation ) {\n\n\n\n\t\t\tthis[ \"op_\" + operation.action]( operation.params);\n\t\t}\n\n\t\tgfxUpdate__old( record ) {//see 152\n\n\t\t\tvar lineLen = 100 * 4;\n\t\t\tvar cellLen = 4;\n\n\t\t\tvar pixels = record.pixels;\n\t\t\tvar ctx = this.ctx;\n\n\t\t\tvar arrs = [];\n\t\t\tvar list = [];\n\t\t\tvar arrNo = -1;\n\n\t\t\tvar areasW = Math.ceil ( this.width / 100 );\n\t\t\tvar areasH = Math.ceil ( this.height /100 );\n\n\t\t\t//console.log(\"Pixels to update \" + pixels.length)\n\t\t\tfor( var i=0; i< pixels.length; i++) {\n\t\t\t\tvar p = pixels[ i ];\n\n\t\t\t\tvar areaNoX = Math.floor( p.x / 100 );\n\t\t\t\tvar areaNoY = Math.floor( p.y / 100 );\n\t\t\t\tvar areaKey = areaNoX + \"_\" + areaNoY;\n\n\t\t\t\tvar pdata;\n\t\t\t\tvar imd;\n\n\t\t\t\tif( !arrs[ areaKey ] ) {\n\t\t\t\t\t//\n\n\t\t\t\t\tvar x0 = areaNoX * 100;\n\t\t\t\t\tvar y0 = areaNoY * 100;\n\t\t\t\t\tvar x1 = x0 + 100 - 1;\n\t\t\t\t\tvar y1 = y0 + 100 - 1;\n\t\t\t\t\tif( x1 > (this.width-1) ) {\n\t\t\t\t\t\tx1 = this.width-1;\n\t\t\t\t\t}\n\t\t\t\t\tif( y1 > (this.height-1) ) {\n\t\t\t\t\t\ty1 = this.height-1;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar w = 1+(x1-x0);\n\t\t\t\t\tvar h = 1+(y1-y0);\n\n\t\t\t\t\timd = ctx.getImageData( x0, y0, w, h );\n\t\t\t\t\tpdata = imd.data;\n\n\t\t\t\t\tvar cache = { x: x0, y: y0, w: w, h: h, imd: imd, pdata: pdata };\n\t\t\t\t\tarrs[ areaKey ] = cache;\n\t\t\t\t\tlist.push( cache );\n\n\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar cache = arrs[ areaKey ];\n\t\t\t\t\tpdata = cache.pdata;\n\t\t\t\t\timd = cache.imd;\n\n\t\t\t\t}\n\n\t\t\t\tvar xrel = p.x - (areaNoX * 100);\n\t\t\t\tvar yrel = p.y - (areaNoY * 100);\n\n\t\t\t\tvar offset = ( yrel * lineLen ) + xrel * cellLen;\n\n\t\t\t\tvar c = this.bmPalette[ p.c ];\n\t\t\t\tpdata[offset+0] = c.r;\n\t\t\t\tpdata[offset+1] = c.g;\n\t\t\t\tpdata[offset+2] = c.b;\n\n\t\t\t}\n\n\n\t\t\tfor( var i = 0; i<list.length; i++) {\n\n\t\t\t\tvar cache = list[ i ];\n\t\t\t\timd = cache.imd;\n\t\t\t\tvar x = cache.x;\n\t\t\t\tvar y = cache.y;\n\t\t\t\tctx.putImageData(imd, x, y);\n\t\t\t}\n\n\t\t}\n\n\n\t\tgfxUpdate( record ) {//see 152\n\n\t\t\tvar lineLen = this.width * 4;\n\t\t\tvar cellLen = 4;\n\n\t\t\tvar pixels = record.pixels;\n\t\t\tvar ctx = this.ctx;\n\n\t\t\tvar upd = this.updCtxImageData;\n\n\t\t\tif(! upd.synched ) {\n\t\t\t\tupd.imd = ctx.getImageData( 0, 0, this.width, this.height );\n\t\t\t\tupd.data = upd.imd.data;\n\t\t\t\tupd.synched = true;\n\t\t\t}\n\n\t\t\tvar pdata = upd.data;\n\t\t\tvar imd = upd.imd;\n\n\t\t\tfor( var i=0; i< pixels.length; i++) {\n\t\t\t\tvar p = pixels[ i ];\n\n\t\t\t\tvar xrel = p.x;\n\t\t\t\tvar yrel = p.y;\n\n\t\t\t\tvar offset = ( yrel * lineLen ) + xrel * cellLen;\n\n\t\t\t\tvar c = this.bmPalette[ p.c ];\n\t\t\t\tpdata[offset+0] = c.r;\n\t\t\t\tpdata[offset+1] = c.g;\n\t\t\t\tpdata[offset+2] = c.b;\n\n\t\t\t}\n\t\t\tctx.putImageData(imd, 0, 0);\n\n\t\t}\n\n\n\t\tupdate( p, list ) {\n\n\t\t\tthis._int_blinkOff();\n\t\t\tthis.show();\n\n\t\t\tthis.x = p.cx;\n\t\t\tthis.y = p.cy;\n\t\t\tif(\n\t\t\t\tthis.x<0 || this.y<0 ||\n\t\t\t\tthis.x>= this.cols || this.y>= this.rows\n\t\t\t) {\n\t\t\t\tconsole.log(\"ouch\");\n\n\t\t\t}\n\n\t\t\tthis.colors.bgHTML = this.palette[ p.bg ];\n\t\t\tthis.colors.fgHTML = this.palette[ \tp.fg ];\n\n\t\t\tfor( var i=0; i< list.length; i++) {\n\n\t\t\t\tvar el = list[ i ];\n\t\t\t\tthis._int_updateArea( el.cells, el.x1, el.y1, el.x2, el.y2 );\n\n\t\t\t}\n\n\n\t\t}\n\n\t\tupdateAll( p, srccells ) {\n\n\t\t\tthis._int_blinkOff();\n\t\t\tthis.show();\n\n\t\t\tthis.x = p.cx;\n\t\t\tthis.y = p.cy;\n\n\t\t\tif(\n\t\t\t\tthis.x<0 || this.y<0 ||\n\t\t\t\tthis.x>= this.cols || this.y>= this.rows\n\t\t\t) {\n\t\t\t\tconsole.log(\"ouch\");\n\n\t\t\t}\n\t\t\tthis.colors.bgHTML = this.palette[ p.bg ];\n\t\t\tthis.colors.fgHTML = this.palette[ \tp.fg];\n\t\t\tthis.colors.bg = p.bg;\n\t\t\tthis.colors.fg = p.fg;\n\n\t\t\tthis._int_updateArea( srccells, 0,0, this.cols -1, this.rows -1 );\n\n\t\t}\n\n\tclear() {\n\t\tthis._int_blinkOff();\n\t\tthis.show();\n\n\t\tvar b=0;\n\t\tfor( var x=0; x<this.cols; x++) {\n\t\t\tb=1-b;\n\t\t\tfor( var y=0; y<this.rows; y++) {\n\t\t\t\tthis.cells[ y ][ x ].txt = \" \";\n\t\t\t\tthis.cells[ y ][ x ].fg = this.colors.fg;\n\t\t\t\tthis.cells[ y ][ x ].bg = this.colors.bg;\n\n\t\t\t}\n\t\t}\n\n\t\tthis.ctx.fillStyle = this.colors.bg;\n\t\tthis.ctx.fillRect(0, 0, this.cvs.width, this.cvs.height);\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\t}\n\n\n\t__int_nl() {\n\t\tthis.x = 0;\n\t\tthis.y ++;\n\t\tif( this.y >= this.rows ) {\n\t\t\tthis.__int_scrollDown();\n\t\t\tthis.y = this.rows -1;\n\t\t}\n\t}\n\n\twriteln( str ) {\n\t\t\tthis._int_blinkOff();\n\t\t\tthis.show();\n\t\t\t//console.log( \"writeln\" + str );\n\n\t\t\tfor (const c of str) {\n\t\t\t  this.__int_write_direct_ch( c );\n\t\t\t}\n\t\t\tthis.__int_nl();\n\t}\n\n\n\t__int_write_direct_ch( ch ) {\n\n\t\tvar cell = this.cells[ this.y ][ this.x ];\n\n\t\tif( cell == null ) {\n\t\t\tconsole.log( \"cell at \" + this.x + \",\" + this.y +\" == null \");\n\t\t\treturn;\n\t\t}\n\n\t\tcell = ch.txt;\n\n\t\tvar ctx = this.ctx;\n\t\tvar fs = this.fontSizeInt;\n\n\t\tvar off = 0;\n\t\tif( this.offsets[ ch.txt ] ) {\n\t\t\toff = this.offsets[ ch.txt ];\n\t\t}\n\n\t\tthis.ctx.fillStyle = this.colors.bgHTML;\n\t\tctx.fillRect(  (fs * this.x) , fs * (this.y ), fs, fs);\n\n\t\tctx.fillStyle = this.colors.fgHTML;\n\t\tctx.fillText( ch.txt , off + (fs * this.x) , fs * (this.y +1));\n\n\t\tthis.x++;\n\t\tif( this.x >= this.cols ) {\n\t\t\tthis.x = 0;\n\t\t\tthis.__int_nl();\n\t\t}\n\t}\n\n\tgetDimensions() {\n\t\t\treturn [this.cols, this.rows ];\n\t}\n\n\thasPixels() {\n\t\treturn true;\n\t}\n\n\tgetBitmapDimensions() {\n\t\treturn [ this.width, this.height ];\n\t}\n\n\t/*plot( x, y, col ) {\n\t\tvar ctx = this.ctx;\n\n\t\tconst pixel = ctx.getImageData( x, y, 1, 1);\n\t\tconst pdata = pixel.data;\n\n\t\tvar c = this.bmPalette[ col ];\n\t\tpdata[0] = c.r;\n\t\tpdata[1] = c.g;\n\t\tpdata[2] = c.b;\n\n\t\tctx.putImageData(pixel, x, y);\n\n\t}*/\n\n\tgetColumCount() {\n\t\treturn this.cols;\n\t}\n\n\tgetRowCount() {\n\t\treturn this.rows;\n\t}\n\n\n\t__int_scrollDown() {\n\t\tfor( var x=0; x<this.cols; x++) {\n\t\t\tfor( var y=0; y<this.rows-1; y++) {\n\t\t\t\tvar cell = this.cells[ y ][ x ];\n\t\t\t\tvar cellyp1 = this.cells[ y+1 ][ x ];\n\n\t\t\t\tcell = cellyp1;\n\n\t\t\t}\n\t\t}\n\n\t\t//fill last row\n\t\tvar y2 = this.rows-1;\n\t\tfor( var x=0; x<this.cols; x++) {\n\t\t\tvar cell = this.cells[ y2 ][ x ];\n\t\t\tcell.txt = \" \";\n\t\t}\n\n\t\tvar fs = this.fontSizeInt;\n\t\tthis.ctx2.drawImage(this.cvs, 0, 0);\n\t\tvar w = this.cvs2.width;\n\t\tvar h = this.cvs2.height-fs;\n\n\t\tthis.ctx.fillStyle = this.colors.bg;\n\t\tthis.ctx.fillRect(0, 0, this.cvs.width, this.cvs.height);\n\n\t\tthis.ctx.drawImage(this.cvs2, 0, fs, w, h-fs, 0, 0, w, h-fs );\n\t\t//drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight)\n\n\t}\n\n}\n\nexport { KERNALMODULE as default};\n","class KERNALMODULE {\n\n  /* QFS - Qualified file system */\n  /* Qualified paths can be used to find files on other file system*/\n  constructor( sys ) {\n    if(!sys) {\n      throw \"sys expected\";\n    }\n\n    this.sys = sys;\n    this.key = sys.SIG + \"__LSConfirmed\" ;\n\n    this.warningOngoing = false;\n\n    console.log(\"simplewarning initialized\");\n\n    sys.notify = this;\n  }\n\n  init() {\n\n  }\n\n  simpleWarning() {\n      if( this.warningOngoing ) {\n        return;\n      }\n\n      this.oldBGColor = document.body.style.backgroundColor;\n      document.body.style.backgroundColor = \"#ffffff\";\n\n      var __this = this;\n      function clearWarning() {\n        document.body.style.backgroundColor = __this.oldBGColor;\n        __this.warningOngoing = false;\n      }\n\n      var myTimeout = setTimeout(clearWarning, 200);\n\n  }\n\n\n\n}\n\nexport { KERNALMODULE as default};\n","class KERNALMODULE {\n\n  /* QFS - Qualified file system */\n  /* Qualified paths can be used to find files on other file system*/\n  constructor( sys ) {\n    if(!sys) {\n      throw \"sys expected\";\n    }\n\n    this.sys = sys;\n    this.key = sys.SIG + \"__LSConfirmed\" ;\n    this.verified = false;\n    this.denied = false;\n\n    console.log(\"PrivWarning initialized\");\n\n  }\n\n  init() {}\n  \n  confirmLocalStorage() {\n\n    if( this.denied ) {\n      return false;\n    }\n\n    var confirmed = localStorage.getItem( this.key );\n    if( confirmed == \"true\" ) { return true; }\n\n    var ok = confirm(\"!! Do you allow \"+\n      this.sys.SIG +\n      \" to write to local browser storage !!\\n\"+\n      \"This is needed to simulate a local harddisk.\\n\" +\n      \" If you do not agree, you can still use the system,\\n\"+\n      \" but you won't be able to save any files, or session information.\\n\\n\"+\n      \"All information will only be stored on the local storage,\\n\"+\n      \" and will not be shared with any server, unless you will give explicit permission.\\n\\n\"+\n      \"Thank you!\"\n    );\n\n    if( !ok ) { this.denied = true; return false; }\n\n    localStorage.setItem( this.key, \"true\" );\n\n    return true;\n  }\n\n\n}\n\nexport { KERNALMODULE as default};\n","class KERNALMODULE {\n\n  constructor( sys ) {}\n\n  init() {}  \n\n  getKey() {\n     return null;\n  }\n\n  setInputHandler( clazz, prefix ) {\n  }\n}\n\nexport { KERNALMODULE as default};\n","class KERNALMODULE {\n\n  constructor( sys ) {\n    if(!sys) {\n      throw \"sys expected\";\n    }\n    this.sys = sys;\n    this.evtQueueKeyPress = [];\n    this.handler = null;\n    this.prefix = \"\";\n  }\n\n  init() {\n    var target = this.init.inputElement;\n\n    if( target ) {\n        this.target = document.body;\n    }\n    else {\n      this.target = document.body;\n    }\n  }\n\n  getKey() {\n\n    if( this.handler ) {\n      return null;\n    }\n    if( this.evtQueueKeyPress.length == 0 ) {\n      return null;\n    }\n\n    return this.evtQueueKeyPress.shift();\n  }\n\n  setInputHandler( clazz, prefix ) {\n    this.handler = clazz;\n    this.prefix = prefix;\n\n    var queuekp = this.evtQueueKeyPress;\n    var con = this.sys.out;\n    var handler = this.handler;\n    var prefix = this.prefix;\n    this.target.inputMode = \"text\";\n    this.target.addEventListener(\"keydown\", (event) => {\n\n      var kEvent =\n      {\n          type: \"keydown\",\n          key: event.key,\n          keyLabel: event.key\n      };\n\n      if( event.key.length > 1) {\n        kEvent.key = null;\n        kEvent.keyLabel = event.key;\n        if( event.key == \"Enter\" ) {\n          kEvent.key = \"\\n\";\n        }\n      }\n\n      event.preventDefault();\n      \n      if( handler ) {\n        handler[ prefix + \"KeyHandler\" ]( kEvent );\n      } else {\n        queuekp.push( kEvent );\n      }\n    });\n  }\n\n}\n\n\nexport { KERNALMODULE as default};\n","class KERNALMODULE {\n\n  constructor( sys ) {\n    if(!sys) {\n      throw \"sys expected\";\n    }\n    this.sys = sys;\n    this.node  = document.body;\n    document.body.id = \"top\";\n    this.isAttr = false;\n  }\n\n  init() {\n  }\n\n  execute( htmlCodeArr ) {\n    var htmlCode = htmlCodeArr[0];\n    console.log( \"execute\",  htmlCode );\n\n    var handle = htmlCode.htmlHandle;\n    if( handle ) {\n      this.setnode( handle );\n    }\n    else {\n      this.isAttr = false;\n    }\n\n    if( this.node == null ) {\n        console.log(\"invalid html root\");\n        return; //TODO back propagate error\n    }\n\n    if( this.isAttr == false ) {\n      /* element */\n\n      if( htmlCode.htmlAppend) {\n        var s = document.createElement(\"span\");\n        s.innerHTML = htmlCode.htmlValue;\n\n        const list = s.childNodes;\n        var arr = [];\n        for (let i = 0; i < list.length; i++) {\n            arr.push( list[i] );\n        }\n\n        for (let i = 0; i < arr.length; i++) {\n            this.node.appendChild( arr[i]  );\n        }\n\n        s = null;\n\n      }\n      else {\n        if( this.node.id == \"top\" ) {\n          console.log(\"Cannot replace body code. it would crash the console!\")\n          return;\n        }\n\n        this.node.innerHTML = htmlCode.htmlValue;\n      }\n    }\n    else {\n      /* attribute */\n\n      var attr = this.node.attributes.getNamedItem( this.attrName );\n      if( attr == null ) {\n        console.log(\"Attr '\"+this.attrName+\"' not found on html node \"+this.node.id+\"!\")\n        return;\n      }\n      attr = attr.nodeValue;\n\n      if( htmlCode.htmlAppend) {\n        attr = attr + htmlCode.htmlValue;\n      }\n      else {\n        attr = htmlCode.htmlValue;\n      }\n\n      this.node.setAttribute( this.attrName, attr );\n    }\n\n  }\n\n\n  setnode( handle ) {\n\n    console.log( \"setnode\",  handle );\n    this.isAttr = false;\n\n    if( handle == \"..\" ) {\n      this.node  = this.node.parentNode;\n    }\n    else {\n      var parts = handle.split(\".\");\n      var attrName = null;\n      var elName = null;\n\n      if( parts.length > 1) {\n        elName = parts[0];\n        attrName = parts[1];\n      }\n      else {\n        elName = handle;\n      }\n\n      if( elName != \"\" ) {\n        var el = document.getElementById(  elName  );\n        if( el ) {\n          this.node = el;\n        }\n        else {\n          console.log(\"could not find\", handle);\n          return;\n        }\n      }\n\n      if( attrName != \"\" && attrName != null ) {\n        this.isAttr = true;\n        this.attrName = attrName;\n    }\n\n  }\n\n}\n/*\n\n\n-- flavour 1\n\nOPEN \"html://\" FOR OUTPUT AS #1\nPRINT #1, \"<b>hello world </b>\"\nCLOSE #1\n\n-- flavour 2\n\nHTM <b id=\"mylabel\">hello world</b>\nHTMINNER \"mylabel\", \"hello 2\"\nHTMCLEAR \"mybody\"\n\nHTM \"b\", \"mylabel\" TO el\nHTMTEXT \"hello world\"\n\n-- flavour 2b\n\n; stay on same line\n+ stay in element\n\n\nHTM \"b\" TO el\nHTMTEXT el, \"hello world\"\n\n\nHTM \"b\"+\nHTMTEXT \"hello world\"+\nHTM \"br\"\nHTMTEXT \"hello world2 \"\n\n\n\n-- flavour 3\n\nHTAG \"b\";\nHTEXT \"hello world\";\nHCLOSE;\n\n-- flavour 4\n\nb = html(\"b\")\nhtml b, \"hello word\"\nsleep\nhtml b, \"hello my world\"\n\ntable = html(\"table\")\n\n--- flavour 5\n\n  #add tag\n\n  b=htag(\"b\")\n\n  or htag \"b\" to b\n\n  or htag \"b\" : REM implicit output variable hnode\n     b = hnode\n\n  hclr b\n  hprint b, \"hello world1\"\n  hprint b, \"hello world2\"\n\n\n  htag \"div\"\n  hstyle hnode add \"bg-color=red\"\n  hstyle hnode add \"font-size=10px\"\n  hprint div, \"hello world1\"\n\n  htag \"div\" in div\n  hstyle hnode add \"bg-color=blue\"\n  hprint div, \"hello world1\"\n\n  console \"\"\n\n\n  ---\n\n  h \"\" to \"<body>\"\n  h \"<div id=1000>Hello world</div>\"\n  h \"\" to 1000\n  hattr \"1000.style\" set     \"background-color=green\"\n  hattr \"1000.style\" append  \";color=red\"\n\n  hshow \"1000\", 0\n  sleep 1\n  hshow \"1000\", 0\n\n  htext \"1234\";\n\n\n----------------\n\ncontent usecases\nc1a append         >\"\"\nc1b append text\nc1c append text with newline\nc2 clear          CLR\nc3 overwrite      \"\"\nc4 get\n\nattr usecases\na1 set attribute\na2 append attribute\na3 get\n\ntarget usecases\nt1 current target      <nothing>\nt2 explicit target     <target>,\"<html>\"\nt3 jump to new target hpos hjmp, hgoto htmlj command\n\n\n*t1\nimplicit :  html \"<b>implicitly in current parent</b>\"\n\n*t2\nexplicit :\n    html 1000, \"<b>explicitly in specified parent</b>\"\n    or\n    html \"<b>explicitly in specified parent</b>\" to 1000\n\n*t3\nexplicit :  html to 1000\n\n\n\n  usecases\n  1a set body\n  1b clear body\n  2 append element in body\n  3 clear Element\n  4 append element in body\n  5 add text to element\n  6 add text to element on same line\n  7 add text to element on next line\n  8 set attr to element\n  9 append into element attr\n\n\n\n  target-and-append-usecases\n  ta1 append to current target\n  ta2 overwrite current target\n\n\n  uc 1a\n  h \"<center>hello world</center>\" to \"<body>\"\n\n  uc 2\n  h \"<div>Hello world</div>\"\n\n  uc 3\n  h \"<div id=1000>Hello world</div>\"\n  h \"\" to 1000\n\n  uc 4\n  h \"<div id=1000>Hello world</div>\"\n  h \"<b>Hello bold world</b>\" to 1000\n\n  uc 5\n  h \"<div id=1000>Hello world</div>\"\n  htxt \"Hello bold world\"\n\n  uc 6\n  h \"<div id=1000>Hello world</div>\"\n  htxt \"Hello bold world\";\n  htxt \"Hello bold world2\"\n\n  uc 7\n  h \"<div id=1000>Hello world</div>\"\n  htxt \"Hello bold world\"\n  htxt \"Hello bold world2\"\n\n\n\n*/\n\n\n}\n\nexport { KERNALMODULE as default};\n","class KERNALMODULE {\n\n  constructor( sys ) {\n\n    this.apps = [];\n    this.sys  = sys;\n\n  }\n\n  init() {\n    var sys = this.sys;\n    var con = sys.out;\n    var htmlwrapper = sys.m.htmlwrapper;\n    var display = sys.m.displaymodes;\n\n    this.out = con;\n\n    if( sys.staticTarget ) {\n      this.worker = new Worker( \"basicworker.js\"   );\n    }\n    else {\n      if( sys.dynamicMinTarget ) {\n        this.worker = new Worker( \"sys/modules/basic/worker/workerbootstrap_min.js\"   );\n      }\n      else {\n        this.worker = new Worker( \"sys/modules/basic/worker/workerbootstrap_max.js\"   );\n      }\n    }\n\n    this.worker.postMessage(\n        {\n          type: \"inittxtarea\",\n          w: con.getColumCount(),\n          h: con.getRowCount()\n        }\n    );\n\n    var hasPixels = con.hasPixels();\n    var bWH = [-1,-1];\n    if( hasPixels ) {\n       bWH = con.getBitmapDimensions();\n    }\n\n    this.worker.postMessage(\n         {\n           type: \"initbitmap\",\n           w: bWH[ 0 ],\n           h: bWH[ 1 ]\n         }\n    );\n\n    var _parent = this;\n    this.worker.onmessage = function(e) {\n\n        var m = e.data.message;\n        var t = e.data.type;\n\n        if( t == \"syslog\" ) {\n           sys.log(\"BWSYS:\", e.data.message );\n        }\n        else if( t == \"syserr\" ) {\n           sys.logerr(\"BWERR:\", e.data.message );\n        }\n        else if( t == \"write\" ) {\n           for( var i =0; i<m.length; i++) {\n             con.write( m[i] );\n           }\n        }\n        else if( t == \"writeln\" ) {\n          for( var i =0; i<m.length; i++) {\n            con.writeln( m[i] );\n          }\n        }\n        else if( t == \"writec\" ) {\n          con.writec( m );\n\n        }\n        else if( t == \"control\" ) {\n          con.control( m );\n        }\n        else if( t == \"control2\" ) {\n          con.control( m.c, m.d );\n        }\n        else if( t == \"blinkMode\" ) {\n          con.blinkMode( m.m );\n        }\n        else if( t == \"locate\" ) {\n          con.setPos( m.c, m.r );\n        }\n        else if( t == \"html\" ) {\n          htmlwrapper.execute( m );\n        }\n        else if( t == \"htmlnode\" ) {\n          htmlwrapper.setnode( m[0].value );\n        }\n        else if( t == \"displaymode\" ) {\n          display.setMode( m.m );\n          con = display.getDriver();\n          sys.out =  con;\n\n          var wh = con.getDimensions();\n          var hasPixels = con.hasPixels();\n          var bWH = [-1,-1];\n\n          if( hasPixels ) {\n            bWH = con.getBitmapDimensions();\n          }\n          this.postMessage(\n            {\n            type: \"message\",\n            processId: m.processId,\n            message: \"displaysize\",\n            messageObject:\n              {\n\n                textW: wh[0], textH: wh[1],\n                bitmapW: bWH[0], bitmapH: bWH[1],\n              }\n            }\n            );\n\n        }\n        else if( t == \"textupdate\" ) {\n\n          var properties = {\n            cx: m.cx,\n            cy: m.cy,\n            fg: m.fg,\n            bg: m.bg,\n          };\n          sys.out.update( properties, m.areasList );\n        }\n        else if( t == \"textupdate-all\" ) {\n\n          var properties = {\n            cx: m.cx,\n            cy: m.cy,\n            fg: m.fg,\n            bg: m.bg,\n          };\n\n          sys.out.updateAll( properties, m.cells );\n        }\n        else if ( t == \"gfxupdate\" ) {\n          sys.out.gfxUpdate( m );\n        }\n        else if ( t == \"export\" ) {\n          var callback = {\n            clazz: _parent,\n            method: \"nullHandler\",\n            data: \"\"\n          }\n          sys.m.qfs.saveFile(\"transfer://myprogram.bas\", m.code, callback);\n        }\n        else if ( t == \"nativeout\" ) {\n          sys.out.native( m );\n        }\n\n\n      }\n  }\n\n  nullHandler( data )  {\n    console.log( \"nullhandler \" + data );\n  }\n\n  loadApp( url0 ) {\n    var sys = this.sys;\n\n    sys.log(\"BSYS:\",\"Load\", url0 );\n    var cb = { clazz: this, method: \"loadedApp\", data: null }\n    this.sys.m.qfs.loadFile( url0, cb );\n\n  }\n\n  loadedApp( cbMessage ) {\n\n    var sys = this.sys;\n    sys.log(\"BSYS:\",\"Loaded\", cbMessage.args.url );\n    this.out.blinkMode( false );\n    this.worker.postMessage({ type: \"loadpgm\", pgmData: cbMessage.data.data, QPath: cbMessage.args.qpath });\n\n  }\n\n  setInput( input ) {\n\n    this.sys.log(\"BSYS: Setting input on BAPPS..\" );\n    this.input = input;\n    this.input.setInputHandler( this, \"input\" );\n\n  }\n\n  inputKeyHandler( kEvent ) {\n    this.worker.postMessage( kEvent );\n  }\n\n}\n\nexport { KERNALMODULE as default};\n","class FILESYSMODULE {\n\n  constructor( sys ) {\n    if(!sys) {\n      throw \"sys expected\";\n    }\n    this.initialized = false;\n    this.sys = sys;\n    this.prefix = sys.SIG + \"__\" ;\n  }\n\n  init() {\n    this.initialize();\n  }\n\n  initialize() {\n    this.currentDisk = \"SYS\";\n    this.initialized=true;\n  }\n\n  ready() {\n    return this.initialized;\n  }\n\n  getEmptyDirStructure(name) {\n    return {files:[], title: \"null\" };\n  }\n\n  getDir() {\n\n    if( !this.initialized ) {\n      return getEmptyDirStructure(null);\n    }\n\n    var storageName =  this.prefix + \"\" + this.currentDisk + \"_dir\";\n    var json = sessionStorage.getItem( storageName );\n    var dir = JSON.parse( json );\n\n    //var title = \"0 \\u0012\\\"\"+dir.title+\"          \\\"\\u0092 00 2A\";\n    var title = dir.title;\n\n    if(!json) {\n      return {files:[], title: title };\n    }\n    dir.title = title;\n    dir.free = 32-dir.files.length;\n\n    var foundNullIx = -1;\n\n    while( true ) {\n      for( var i=0; i<dir.files.length; i++) {\n        if( dir.files[i] == null) {\n          foundNullIx = i;\n          break;\n        }\n      }\n      if( foundNullIx > -1) {\n        dir.files.splice( foundNullIx, 1 );\n        foundNullIx = -1;\n      }\n      else {\n        break;\n      }\n    }\n    return dir;\n\n  }\n\n\n  setDir( dir ) {\n\n\n    if( this.privacy.confirmLocalStorage() == false ) { return ; }\n\n    if( !this.initialized ) {\n      return;\n    }\n\n    var storageName =  this.prefix + \"\" + this.currentDisk + \"_dir\";\n\n    sessionStorage.setItem(storageName, JSON.stringify( dir ) );\n\n  }\n\n  existsFile( fileName ) {\n\n    if( !this.initialized ) {\n      return false;\n    }\n\n    var dir = this.getDir();\n\n    var found = -1;\n    for( var i=0; i<dir.files.length; i++) {\n      if( dir.files[i].fname == fileName ) {\n        found  = i;\n        break;\n      }\n    }\n\n    if( found > -1 ) {\n      return true;\n    }\n    return false;\n  }\n\n\n  removeFromDir( fileName ) {\n\n    if( !this.initialized ) {\n      return;\n    }\n\n    var dir = this.getDir();\n\n    var found = -1;\n    for( var i=0; i<dir.files.length; i++) {\n      if( dir.files[i].fname == fileName ) {\n        found  = i;\n        break;\n      }\n    }\n\n    if( found > -1 ) {\n      dir.files.splice( i, 1 );\n    }\n    this.setDir(dir);\n  }\n\n  updateDir( fileName, programLen, type ) {\n\n    if( !this.initialized ) {\n      return;\n    }\n\n    var dir = this.getDir();\n\n    var found = -1;\n    for( var i=0; i<dir.files.length; i++) {\n      if( dir.files[i].fname == fileName ) {\n        found  = i;\n        break;\n      }\n    }\n\n    if( found > -1 ) {\n      dir.files[i].size = programLen;\n      dir.files[i].type = type;\n    }\n    else {\n      dir.files.push( {fname: fileName, size: programLen, type: type } );\n    }\n    this.setDir(dir);\n  }\n\n\n  saveFile( fileName0, data, type, length ) {\n\n    if( !this.initialized ) {\n      return false;\n    }\n\n    if( this.privacy.confirmLocalStorage() == false ) { return false; }\n\n    var fileName = fileName0;\n    if( fileName0.length > 32) {\n        fileName = fileName0.substr(0,32);\n    }\n\n    var storageName =  this.prefix + \"\" + this.currentDisk + \"_\" + fileName;\n\n    var container = JSON.stringify( { type: type, data: data} );\n    sessionStorage.setItem(storageName, container );\n\n    this.updateDir( fileName, length, type );\n\n    return true;\n  }\n\n  loadFile( fileName ) {\n\n    if( !this.initialized ) {\n      return null;\n    }\n\n    var storageName =  this.prefix + \"\" + this.currentDisk + \"_\" + fileName;\n\n    var json = sessionStorage.getItem( storageName );\n\n    return JSON.parse( json );\n  }\n\n  deleteFile( fileName ) {\n    if( ! this.existsFile( fileName ) ) {\n      return \"no such file\";\n    }\n\n    try {\n      this.removeFromDir( fileName );\n      this._removeFile( fileName );\n    }\n    catch ( e ) {\n      return \"unexpected\";\n    }\n    return \"ok\";\n  }\n\n  _removeFile( fileName ) {\n\n    var storageName =  this.prefix + \"\" +\n      this.currentDisk + \"_\" +\n      fileName;\n\n    sessionStorage.removeItem( storageName );\n\n  }\n\n  formatDisk() {\n\n    var dir = this.getDir();\n\n    for( var i=0; i<dir.files.length; i++) {\n\n        var fileName = dir.files[i].fname;\n        this._removeFile( fileName );\n\n    }\n\n    dir.files = [];\n    dir.title = \"Empty\"\n    this.setDir( );\n\n  }\n\n\n  getFullDisk() {\n\n    if( !this.initialized ) {\n\n      var dir = this.getDir();\n\n      var disk = {\n        dir: dir,\n        content: []\n      };\n\n      var diskStr = JSON.stringify( disk );\n\n      return diskStr;\n    }\n\n    var dir = this.getDir();\n    var content = [];\n\n    for( var i=0; i<dir.files.length; i++) {\n        var fileName = dir.files[i].fname;\n        var storageName =  this.prefix + \"\" + this.currentDisk + \"_\" + fileName;\n        var json = sessionStorage.getItem( storageName );\n        content.push( { fname: fileName ,content: json} );\n    }\n\n    var disk = {\n      dir: dir,\n      content: content\n    };\n\n    var diskStr = JSON.stringify( disk );\n\n    console.log( diskStr );\n\n    return diskStr;\n  }\n\n}\n\nexport { FILESYSMODULE as default};\n","class FILESYSMODULE {\n\n  constructor( sys ) {\n    if(!sys) {\n      throw \"sys expected\";\n    }\n    this.initialized = false;\n    this.sys = sys;\n    this.prefix = sys.SIG + \"__\" ;\n\n    console.log( sys );\n\n  }\n\n  init() {\n    this.initialize();\n  }\n\n  initialize() {\n\n    this.privacy = this.sys.m.priv;\n\n    this.disks = [];\n    this.currentDisk = null;\n    var defaultDisk = \"0001\"\n\n    var json = localStorage.getItem( this.prefix + \"disks_list\" );\n    if( json == null ) {\n\n      var diskId = \"0001\";\n      var diskName = \"Default\";\n      this.disks = [ diskId ];\n      this.currentDisk = diskId;\n      this.lastDisk = 1;\n\n      if( this.privacy.confirmLocalStorage() == true ) {\n        localStorage.setItem( this.prefix + \"disks_list\", JSON.stringify( this.disks ) );\n        localStorage.setItem( this.prefix + \"0001_dir\", JSON.stringify( {files:[], title: diskName, readOnly: false } ) );\n        localStorage.setItem( this.prefix + \"disk_current\", diskId );\n      }\n    }\n    else {\n      this.disks = JSON.parse( json );\n      this.currentDisk = localStorage.getItem( this.prefix + \"disk_current\" );\n\n      var last = -1;\n      for( var i=0; i<this.disks.length; i++) {\n        if( parseInt( this.disks[i] ) > last ) {\n          last = parseInt( this.disks[ i ] );\n        }\n      }\n      this.lastDisk = last;\n    }\n\n\n    this.initialized=true;\n\n  }\n\n  isASynch() {\n    return false;\n  }\n\n  selectDisk( diskId ) {\n    this.currentDisk = diskId;\n\n    if( this.privacy.confirmLocalStorage() == true ) {\n      localStorage.setItem( this.prefix + \"disk_current\", diskId );\n    }\n  }\n\n  ready() {\n    return this.initialized;\n  }\n\n\n  getDisks() {\n\n    if( !this.initialized ) {\n      return [];\n    }\n\n    var storageName =  this.prefix + \"disks_list\";\n    var json = localStorage.getItem( storageName );\n    var disks = JSON.parse( json );\n\n    return disks;\n\n  }\n\n  getEmptyDirStructure(name) {\n    return {files:[], title: \"null\" };\n  }\n\n  getDir() {\n\n    if( !this.initialized ) {\n      return getEmptyDirStructure(null);\n    }\n\n    var storageName =  this.prefix + \"\" + this.currentDisk + \"_dir\";\n    var json = localStorage.getItem( storageName );\n    var dir = JSON.parse( json );\n\n    //var title = \"0 \\u0012\\\"\"+dir.title+\"          \\\"\\u0092 00 2A\";\n    var title = dir.title;\n\n    if(!json) {\n      return {files:[], title: title };\n    }\n    dir.title = title;\n    dir.free = 32-dir.files.length;\n\n    var foundNullIx = -1;\n\n    while( true ) {\n      for( var i=0; i<dir.files.length; i++) {\n        if( dir.files[i] == null) {\n          foundNullIx = i;\n          break;\n        }\n      }\n      if( foundNullIx > -1) {\n        dir.files.splice( foundNullIx, 1 );\n        foundNullIx = -1;\n      }\n      else {\n        break;\n      }\n    }\n    return dir;\n\n  }\n\n  getSelectedDir( x ) {\n\n    if( !this.initialized ) {\n      return {files:[], title: \"null\" };\n    }\n\n    var storageName =  this.prefix + \"\" + x + \"_dir\";\n    var json = localStorage.getItem( storageName );\n    var dir = JSON.parse( json );\n\n    //var title = \"0 \\u0012\\\"\"+dir.title+\"          \\\"\\u0092 00 2A\";\n    var title = dir.title;\n\n    if(!json) {\n      return {files:[], title: title };\n    }\n    dir.title = title;\n    dir.free = 32-dir.files.length;\n    return dir;\n\n  }\n\n  setDir( dir ) {\n\n    if( !this.initialized ) {\n      return;\n    }\n\n    var storageName =  this.prefix + \"\" + this.currentDisk + \"_dir\";\n\n    if( this.privacy.confirmLocalStorage() == true ) {\n      localStorage.setItem(storageName, JSON.stringify( dir ) );\n    }\n\n  }\n\n  existsFile( fileName ) {\n\n    if( !this.initialized ) {\n      return false;\n    }\n\n    var dir = this.getDir();\n\n    var found = -1;\n    for( var i=0; i<dir.files.length; i++) {\n      if( dir.files[i].fname == fileName ) {\n        found  = i;\n        break;\n      }\n    }\n\n    if( found > -1 ) {\n      return true;\n    }\n    return false;\n  }\n\n\n  removeFromDir( fileName ) {\n\n    if( !this.initialized ) {\n      return;\n    }\n\n    var dir = this.getDir();\n\n    var found = -1;\n    for( var i=0; i<dir.files.length; i++) {\n      if( dir.files[i].fname == fileName ) {\n        found  = i;\n        break;\n      }\n    }\n\n    if( found > -1 ) {\n      dir.files.splice( i, 1 );\n    }\n    this.setDir(dir);\n  }\n\n  updateDir( fileName, programLen, type ) {\n\n    if( !this.initialized ) {\n      return;\n    }\n\n    var dir = this.getDir();\n\n    var found = -1;\n    for( var i=0; i<dir.files.length; i++) {\n      if( dir.files[i].fname == fileName ) {\n        found  = i;\n        break;\n      }\n    }\n\n    if( found > -1 ) {\n      dir.files[i].size = programLen;\n      dir.files[i].type = type;\n    }\n    else {\n      dir.files.push( {fname: fileName, size: programLen, type: type } );\n    }\n    this.setDir(dir);\n  }\n\n\n  saveFile( fileName0, data, type, length ) {\n\n    if( !this.initialized ) {\n      return;\n    }\n\n    var fileName = fileName0;\n    if( fileName0.length > 32) {\n        fileName = fileName0.substr(0,32);\n    }\n\n    if( fileName.startsWith(\"$/\") ) {\n      fileName = fileName.substr( 2 );\n    }\n\n    var storageName =  this.prefix + \"\" + this.currentDisk + \"_\" + fileName;\n\n    //save pgm\n    var container = JSON.stringify( { type: type, data: data} );\n    if( this.privacy.confirmLocalStorage() == true ) {\n      localStorage.setItem(storageName, container );\n      this.updateDir( fileName, length, type );\n    }\n  }\n\n  loadJSONFile( fileName ) {\n\n    if( !this.initialized ) {\n      return null;\n    }\n\n    var storageName =  this.prefix + \"\" + this.currentDisk + \"_\" + fileName;\n\n    var json = localStorage.getItem( storageName );\n\n    return JSON.parse( json );\n  }\n\n  loadFile( fileName0 ) {\n\n    if( !this.initialized ) {\n      return null;\n    }\n\n    var fileName = fileName0;\n    if( fileName0.length > 32) {\n        fileName = fileName0.substr(0,32);\n    }\n\n    if( fileName.startsWith(\"$/\") ) {\n      fileName = fileName.substr( 2 );\n    }\n\n    var storageName =  this.prefix + \"\" + this.currentDisk + \"_\" + fileName;\n\n    var data = localStorage.getItem( storageName );\n\n    return JSON.parse( data );\n  }\n\n  deleteFile( fileName ) {\n    if( ! this.existsFile( fileName ) ) {\n      return \"no such file\";\n    }\n\n    try {\n      this.removeFromDir( fileName );\n      this._removeFile( fileName );\n    }\n    catch ( e ) {\n      return \"unexpected\";\n    }\n    return \"ok\";\n  }\n\n  _removeFile( fileName ) {\n\n    var storageName =  this.prefix + \"\" +\n      this.currentDisk + \"_\" +\n      fileName;\n\n    localStorage.removeItem( storageName );\n\n  }\n\n  formatDisk() {\n\n    var dir = this.getDir();\n\n    for( var i=0; i<dir.files.length; i++) {\n\n        var fileName = dir.files[i].fname;\n        this._removeFile( fileName );\n\n    }\n\n    dir.files = [];\n    dir.title = \"Empty\"\n    this.setDir( );\n\n  }\n\n  createDiskFromImage( name, image ) {\n\n    this.createDiskFromImage2( name, image, false );\n\n  }\n\n  createSysDiskFromImage( image ) {\n\n    this.createDiskFromImage2( \"SYS\", image, true );\n\n  }\n\n  createDiskFromImage2( name, image, sysDisk ) {\n\n    if( this.privacy.confirmLocalStorage() == false ) { return ; }\n\n    var labl;\n    if( !sysDisk ) {\n      this.lastDisk++;\n      labl = \"\" + this.lastDisk;\n    }\n    else {\n      labl = \"\" + 1;\n    }\n\n    labl = labl.padStart( 4,\"0\");\n    var dir = image.dir;\n    var content = image.outtent;\n\n    var storageName =  this.prefix + \"\" + labl + \"_dir\";\n\n\n    localStorage.setItem(storageName, JSON.stringify( dir ) );\n\n\n    for( var i=0; i<content.length; i++) {\n        var fileName = content[i].fname;\n        var storageName =  this.prefix + \"\" + labl + \"_\" + fileName;\n        localStorage.setItem( storageName, content[i].outtent );\n    }\n\n    this.disks.push( labl );\n    localStorage.setItem( this.prefix + \"disks_list\", JSON.stringify( this.disks ) );\n\n  }\n\n  createDisk() {\n\n    if( this.privacy.confirmLocalStorage() == false ) { return ; }\n    var existingDisks = this.getDisks();\n    this.lastDisk ++;\n    var labl = \"\" + this.lastDisk;\n    labl = labl.padStart( 4,\"0\");\n\n    var newDir = this.getEmptyDirStructure(\"NEW DISK\");\n\n    var storageName =  this.prefix + \"\" + labl + \"_dir\";\n    localStorage.setItem(storageName, JSON.stringify( newDir ) );\n\n    this.disks.push( labl );\n    localStorage.setItem( this.prefix + \"disks_list\", JSON.stringify( this.disks ) );\n\n  }\n\n  getFullDisk() {\n\n    if( !this.initialized ) {\n\n      var dir = this.getDir();\n\n      var disk = {\n        dir: dir,\n        content: []\n      };\n\n      var diskStr = JSON.stringify( disk );\n\n      return diskStr;\n    }\n\n    var dir = this.getDir();\n    var content = [];\n\n    for( var i=0; i<dir.files.length; i++) {\n        var fileName = dir.files[i].fname;\n        var storageName =  this.prefix + \"\" + this.currentDisk + \"_\" + fileName;\n        var json = localStorage.getItem( storageName );\n        content.push( { fname: fileName ,content: json} );\n    }\n\n    var disk = {\n      dir: dir,\n      content: content\n    };\n\n    var diskStr = JSON.stringify( disk );\n\n    console.log( diskStr );\n\n    return diskStr;\n  }\n\n}\n\nexport { FILESYSMODULE as default};\n","class FILESYSMODULE {\n\n  constructor( sys ) {\n    if(!sys) {\n      throw \"sys expected\";\n    }\n    this.sys = sys;\n\n    this.files = [];\n    this.data  = {};\n\n  }\n\n  init() {}\n\n  isASynch() {\n    return false;\n  }\n\n  ready() {\n    return true;\n  }\n\n  getDir() {\n    return this.files;\n  }\n\n  exists( fileName ) {\n\n    var files = this.getDir();\n\n    var found = -1;\n    for( var i=0; i<files.length; i++) {\n      if( files[i].fname == fileName ) {\n        found  = i;\n        break;\n      }\n    }\n\n    if( found > -1 ) {\n      return true;\n    }\n    return false;\n  }\n\n  saveFile( fileName, data, type, size ) {\n\n    if( fileName.indexOf(\"/\") >-1 ) {\n      throw {\n        message: \"saveFile: '\"+fileName+\"' - invalid path, RAMFS device only supports flatdir\"\n      }\n    }\n    if( ! this.exists( fileName ) ) {\n      var fEntry = {\n        fname: fileName,\n        type: type,\n        size: size\n      }\n\n      this.data[ fileName ] = { type: type, data: data};\n      this.files.push( fEntry );\n    }\n\n  }\n\n  loadFile( fileName ) {\n\n    if( ! this.exists( fileName ) ) {\n      return null;\n    }\n\n    return this.data[ fileName ];\n\n  }\n\n  deleteFile( fileName ) {\n\n    if( ! this.existsFile( fileName ) ) {\n      return false;\n    }\n\n    try {\n      var files = this.files;\n\n      for( var i=0; i<files.length; i++) {\n        if( files[i].fname == fileName ) {\n          files[ i ] = undefined;\n          break;\n        }\n      }\n\n      this.data[ fileName ] = undefined;\n    }\n    catch ( e ) {\n      throw {\n        message: \"deleteFile: '\" + fileName + \"' - \" + e.message\n      }\n    }\n    return true;\n  }\n\n  formatDisk() {\n\n    this.files = [];\n    this.data  = {};\n\n  }\n\n}\n\nexport { FILESYSMODULE as default};\n","class FILESYSMODULE {\n\n  constructor( sys ) {\n    if(!sys) {\n      throw \"sys expected\";\n    }\n    this.sys = sys;\n\n    this.files = [];\n    this.data  = {};\n\n  }\n\n  init() {}\n\n  isASynch() {\n    return false;\n  }\n\n  ready() {\n    return true;\n  }\n\n  exists( fileName ) {\n\n    var el = document.getElementById( fileName );\n\n    if( el ) {\n      return true;\n    }\n  }\n\n  saveFile( fileName, data, type, size ) {\n\n    throw { message: \"saveFile '\"+fileName+\"' - SCRIPTURL is readonly\" }\n\n  }\n\n  loadFile( fileName ) {\n\n    if( ! this.exists( fileName ) ) {\n      return null;\n    }\n\n\n    var el = document.getElementById( fileName );\n\n    var lines = el.innerText.split(\"\\n\");\n    var data = \"\";\n    for( var i=0; i<lines.length; i++) {\n      if( data != \"\") { data += \"\\n\"; }\n      data+= lines[ i ].trim();\n    }\n\n    return { type: \"bas\", data: data };\n\n  }\n\n  deleteFile( fileName ) {\n\n    throw { message: \"deleteFile '\"+fileName+\"' - SCRIPTURL is readonly\" }\n\n  }\n\n  formatDisk() {\n\n    throw { message: \"formatDisk '\"+fileName+\"' - SCRIPTURL is readonly\" }\n\n  }\n\n}\n\nexport { FILESYSMODULE as default};\n","class FILESYSMODULE {\n\n  /* QFS - Qualified file system */\n  /* Qualified paths can be used to find files on other file system*/\n  constructor( sys, dependencies ) {\n    if(!sys) {\n      throw \"sys expected\";\n    }\n    if(!dependencies) {\n      throw \"dependencies expected\";\n    }\n\n    this.dependencies = dependencies;\n    this.initialized = false;\n    this.sys = sys;\n    this.prefix = sys.SIG + \"__\" ;\n  }\n\n  init() {\n    this.initialize();\n  }\n\n  initialize() {\n\n    this.fsList = [];\n    var dependencies = this.dependencies;\n\n    for( var i=0; i< dependencies.length; i++) {\n        var fsToken = dependencies[i];\n        var fs = {\n          token: fsToken,\n          fs: this.sys.m[ fsToken ],\n          prefix: fsToken + \"://\"\n        }\n        this.fsList.push( fs );\n    }\n\n     this.initialized = true;\n  }\n\n  ready() {\n    return this.initialized;\n  }\n\n  getFS( qpath ) {\n\n    var fsList = this.fsList;\n\n    for( var i=0; i< fsList.length; i++) {\n        var fs = fsList[i];\n        if( qpath.startsWith( fs.prefix ) ) {\n          return fs;\n        }\n    }\n\n    return null;\n  }\n\n  getLPath( qpath ) {\n    var parts = qpath.split(\"://\");\n    if( parts.length <2 ) { return null; }\n    return parts[ 1 ];\n  }\n\n  getDir( qpath ) {\n\n    if( !this.initialized ) {\n      return false;\n    }\n\n    return [];\n  }\n\n  existsFile( qpath ) {\n\n    if( !this.initialized ) {\n      return false;\n    }\n\n    return false;\n  }\n\n  doCallBack( callback, callBackResponse ) {\n\n    if( callback.clazz )  {\n\n        if( callback.data ) {\n          callBackResponse.cbData = callback.data;\n        }\n        callback.clazz[ callback.method ]( callBackResponse );\n\n    }\n    else {\n        callback( callBackResponse );\n    }\n\n\n  }\n\n  saveFile(\n      /*mandatory*/ qpath, data, callRecord,\n      /*optional*/ type, length ) {\n\n    if( !this.initialized ) {\n      return null;\n    }\n\n    var fsRecord = this.getFS( qpath );\n    if( !fsRecord ) {\n      throw { message: qpath + \" has unknown file system\" };\n    }\n\n    var lpath = this.getLPath( qpath );\n    if( !lpath ) {\n      throw { message: \"QPath '\" + qpath + \"' has no local path\" };\n    }\n\n    if( ! fsRecord.fs.isASynch() ) {\n      var result = fsRecord.fs.saveFile( lpath, data, type, length );\n\n      var args = {};\n      args.qpath = qpath;\n      args.type = type;\n      args.length = length;\n\n      var callBackResponse = { result: result, args: args };\n\n      this.doCallBack( callRecord, callBackResponse );\n\n    }\n\n    return null;\n\n\n  }\n\n  loadFile( qpath , callRecord  ) {\n\n    if( !this.initialized ) {\n      return null;\n    }\n\n    var fsRecord = this.getFS( qpath );\n    if( !fsRecord ) {\n      throw { message: qpath + \" has unknown file system\" };\n    }\n\n    var lpath = this.getLPath( qpath );\n    if( !lpath ) {\n      throw { message: \"QPath '\" + qpath + \"' has no local path\" };\n    }\n\n    if( ! fsRecord.fs.isASynch() ) {\n      var data = fsRecord.fs.loadFile( lpath );\n\n      var callBackResponse = {\n        data: data,\n        cbData: callRecord.data,\n        args: { qpath: qpath }\n      };\n      callRecord.clazz[ callRecord.method ]( callBackResponse );\n    }\n\n    return null;\n  }\n\n  deleteFile( qpath ) {\n\n    if( ! this.existsFile( fileName ) ) {\n      return \"no such file\";\n    }\n\n    return \"error\";\n  }\n\n  formatDisk( qpath ) {\n\n    if( ! this.existsFile( fileName ) ) {\n      return \"no such file\";\n    }\n\n    return \"error\";\n\n  }\n\n\n}\n\nexport { FILESYSMODULE as default};\n"],"names":["boot","constructor","staticFlag","sys","this","m","init","staticTarget","domContainer","document","createElement","body","appendChild","SIG","VERSION","CODENAME","nulcon","push","rootScript","getElementById","displayMode","parseInt","dataset","mode","bootMode","dynamicMinTarget","indexOf","bootDebug","style","backgroundColor","getSys","initSimpleLogging","out","buf","getAll","writeln","txt","s","console","log","rawlog","type","array","line","j","length","sep","rawlogcon","args","Array","prototype","slice","call","arguments","apply","logwarn","warn","logerr","error","dep","i","displaymodes","initialized","default","drivers","tablecon","canvas","modes","textmode1","textmode2","textmode3","textmode4","getDriver","currentDriver","getMode","x","setMode","Number","isNaN","dc","getDeviceConfig","cm","currentMode","endMode","device","initMode","config","destroy","undefined","tmp","split","driver","splice","cursorOn","cols","rows","y","hidden","blinking","reverse","outColors","fontSizeInt","fontSizeCSS","fontFamily","colors","txtBgColor","txtColor","outDiv0","remove","cvs","cvs2","ctx","ctx2","rowel","cellel","blinkInterval","clearInterval","getColumCount","getRowCount","getDimensions","msgs","queuedMessages","inputElement","colsPercentage","outDiv1","outEl","value","addEventListener","event","sel","selection","createRange","toString","window","getSelection","rangeCount","getRangeAt","cloneContents","childNodes","text","rix","cix","firstChild","data","getTextOfSelection","clipboardData","setData","preventDefault","table","borderCollapse","borderSpacing","resize","fontSize","tableLayout","readOnly","textAlign","tr","padding","maxHeight","height","rowArray","td","color","textOverflow","whiteSpace","overflow","maxWidth","innerHTML","display","width","position","zIndex","verticalAlign","marginLeft","marginRight","focus","dirty","dirtyFlags","bg","_this","setInterval","_int_blink","native","operation","action","blinkMode","hasPixels","_int_updateArea","srccells","x0","y0","x1","y1","cell","src","textContent","fg","update","p","list","_int_blinkOff","show","cx","cy","el","cells","x2","y2","updateAll","hide","getElement","clear","__int_nl","__int_scrollDown","str","c","substr","__int_write_direct_ch","ch","cellyp1","palette","bmPalette","htmlCol","r","g","b","defaultTextMode","cvs3","ctx3","cache","oc","bgHTML","fgHTML","cursorMode","w","h","Math","floor","center","getContext","alpha","strokeStyle","cX","cY","updCtxImageData","synched","fs","offsets","font","textBaseline","fsid2","tmp0","measureText","drawImage","_int_storeset_color","oldfg","oldbg","_int_restore_color","index","index2","paintCursor","paintchar","e","col1","col2","cacheel","off","fillStyle","fillRect","fillText","op_gcolor","params","op_line","beginPath","moveTo","lineTo","stroke","gfxUpdate__old","record","pixels","arrs","ceil","pdata","imd","areaNoX","areaNoY","areaKey","getImageData","xrel","offset","putImageData","gfxUpdate","lineLen","upd","getBitmapDimensions","simplewarning","key","warningOngoing","notify","simpleWarning","oldBGColor","__this","setTimeout","priv","verified","denied","confirmLocalStorage","localStorage","getItem","confirm","setItem","mutedinput","getKey","setInputHandler","clazz","prefix","domelinput","evtQueueKeyPress","handler","target","shift","queuekp","inputMode","kEvent","keyLabel","htmlwrapper","node","id","isAttr","execute","htmlCodeArr","htmlCode","handle","htmlHandle","setnode","htmlAppend","htmlValue","arr","attr","attributes","getNamedItem","attrName","nodeValue","setAttribute","parentNode","parts","elName","basic","apps","con","worker","Worker","postMessage","bWH","_parent","onmessage","message","t","write","writec","control","d","setPos","wh","processId","messageObject","textW","textH","bitmapW","bitmapH","properties","areasList","callback","method","qfs","saveFile","code","nullHandler","loadApp","url0","cb","loadFile","loadedApp","cbMessage","url","pgmData","QPath","qpath","setInput","input","inputKeyHandler","sfs","initialize","currentDisk","ready","getEmptyDirStructure","name","files","title","getDir","storageName","json","sessionStorage","dir","JSON","parse","free","foundNullIx","setDir","privacy","stringify","existsFile","fileName","found","fname","removeFromDir","updateDir","programLen","size","fileName0","container","deleteFile","_removeFile","removeItem","formatDisk","getFullDisk","disk","content","diskStr","lfs","disks","diskId","lastDisk","last","isASynch","selectDisk","getDisks","getSelectedDir","startsWith","loadJSONFile","createDiskFromImage","image","createDiskFromImage2","createSysDiskFromImage","sysDisk","labl","padStart","outtent","createDisk","newDir","ramfs","exists","fEntry","script","lines","innerText","trim","dependencies","fsList","fsToken","token","getFS","getLPath","doCallBack","callBackResponse","cbData","callRecord","fsRecord","lpath","result","mods","Object","getOwnPropertyNames","conStyle","onReady","alert"],"sourceRoot":""}
(()=>{"use strict";boot=new class{constructor(t){var e={};this.m={},e.m=this.m,this.sys=e,e.init={},e.staticTarget=t,e.SIG="boss64",e.VERSION="0.1",e.CODENAME="Papa Smurf",e.nulcon=[],e.nulcon.push("Starting BOSS..."),e.nulcon.push("BOS version "+e.VERSION),e.nulcon.push("BOS signature "+e.SIG),e.nulcon.push('BOS release name "'+e.CODENAME+'"'),e.nulcon.push("Starting Boot Sequence...");var i=document.getElementById("boot");this.rootScript=i,this.modeAttr=i.dataset.mode;var s=this.modeAttr.indexOf(":");this.displayMode=i.dataset.mode.substr(0,s),this.conStyle=i.dataset.mode.substr(s+1),this.bootMode=i.dataset.boot,this.bootDebug="debug"==this.bootMode,document.body.style.backgroundColor="#444444"}getSys(){return this.sys}initSimpleLogging(){var t=this.sys;t.out={buf:""};var e=t.out;t.out.getAll=function(){return e.buf},t.out.writeln=function(t){var i="$"+t+"\n";e.buf+=i,console.log(i)},e.writeln("$Init logging..."),t.rawlog=function(e,i){var s=i,r="";r+=e+": ";for(var o=0;o<s.length;o++){var l=" ";0==o&&(l=""),r+=l+s[o]}t.out.writeln(r)},t.rawlogcon=function(t,e){var i=e,s="";s+=t+": ";for(var r=0;r<i.length;r++){var o=" ";0==r&&(o=""),s+=o+i[r]}console.log(s)},t.log=function(){var e=Array.prototype.slice.call(arguments);t.rawlog("info",e),console.log.apply(console,e)},t.logwarn=function(){var e=Array.prototype.slice.call(arguments);t.rawlog("warn",e),console.warn(e)},t.logerr=function(){var e=Array.prototype.slice.call(arguments);t.rawlog("error",e),console.error.apply(console,e)},boot.logerr=t.logerr,boot.logwarn=t.logwarn,boot.log=t.log,this.bootDebug||(t.rawlog=t.rawlogcon)}}(!0);var t=boot.getSys();boot.dep={},boot.m.tablecon=class{constructor(t){this.sys=t,this.cursorOn=!1,this.cols=80,this.rows=30,this.x=0,this.y=0,this.hidden=!1,this.outColors={},this.fontSize="18px",this.fontFamily="monospace",this.reverse=!1,this.colors=["#000000","#ffffff","#ee2222","#22ee22","#2222ee","#eeee22","#22eeee","#ee22ee","#aaaaaa","#777777","#444444","#FFAC1C","#5C3317","#F88379","#79F883","#8379F8"],this.outColors.txtBgColor=this.colors[0],this.outColors.txtColor=this.colors[5]}init(){var t=this.sys,e=t.init.queuedMessages,i=t.init.conStyle,s=t.init.displayMode;if(t.init.inputElement=document.body,this.outDiv0=document.createElement("div"),this.outDiv1=document.createElement("div"),this.outEl=document.createElement("table"),this.outEl.value="",this.outEl.addEventListener("copy",(t=>{var e=function(){if(document.selection&&document.selection.createRange)return document.selection.createRange().htmlText;if(window.getSelection){var t=window.getSelection();if(t.rangeCount>0){var e=t.getRangeAt(0).cloneContents(),i=document.createElement("div");return i.appendChild(e),i.innerHTML}return""}return""}();console.log("an selection",e),console.log("an event",t)})),s&&"default"!=s&&2==(r=s.split("x")).length&&(this.rows=parseInt(r[1]),this.cols=parseInt(r[0])),this.colsPercentage=1/this.cols*100,i){var r,o=0;(r=i.split(":")).length>o&&""!=r[o]&&(this.fontSize=r[o]),o++,r.length>o&&""!=r[o]&&(this.fontFamily=r[o]),o++,r.length>o&&""!=r[o]&&(this.outColors.txtBgColor=this.colors[parseInt(r[o])]),o++,r.length>o&&""!=r[o]&&(this.outColors.txtColor=this.colors[parseInt(r[o])]),o++}this.table=this.outEl,this.table.style.borderCollapse="collapse",this.table.style.borderSpacing=0,this.table.style.backgroundColor=this.outColors.txtBgColor,this.table.style.resize="none",this.table.style.fontFamily=this.fontFamily,this.table.style.fontSize=this.fontSize,this.table.readOnly=!0,this.table.style.tableLayout="fixed",this.rowel=[],this.cellel=[];for(var l=0;l<this.rows;l++){var n=document.createElement("tr");n.style.padding="0px",this.rowel.push(n),this.outEl.appendChild(n);for(var a=[],h=0;h<this.cols;h++){var c=document.createElement("td");c.style.padding="0px",c.style.color=this.outColors.txtColor,c.style.backgroundColor=void 0,c.innerHTML="&nbsp;",a.push(c),n.appendChild(c)}this.cellel.push(a)}document.body.appendChild(this.outDiv0),this.outDiv0.style.display="table",this.outDiv0.style.width="99%",this.outDiv0.style.height="99%",this.outDiv0.style.position="absolute",this.outDiv0.style.zIndex="10000",this.outDiv1.style.display="table-cell",this.outDiv1.style.verticalAlign="middle",this.table.style.marginLeft="auto",this.table.style.marginRight="auto",this.outDiv0.appendChild(this.outDiv1),this.outDiv1.appendChild(this.outEl),this.outEl.focus(),this.dirty=!0,this.dirtyFlags={bg:!0,color:!0};var u=this;setInterval((function(){u.blink()}),500);for(var d=0;d<e.length;d++)this.writeln(e[d]);this.sys.log("TBCON Ready.")}hide(){this.hidden||(this.outDiv0.hidden=!0,this.hidden=!0)}show(){this.hidden&&(this.outDiv0.hidden=!1,this.hidden=!1)}getElement(){return null}blinkOf(){if(this.cursorOn){this.cursorOn=!1;var t=this.cellel[this.y][this.x];null!=t?t.innerHTML="":console.log("cell at "+this.x+","+this.y+" == null ")}}blink(){var t=this.cellel[this.y][this.x];null!=t?(this.cursorOn=!this.cursorOn,this.cursorOn?t.innerHTML="â–ˆ":t.innerHTML=""):console.log("cell at "+this.x+","+this.y+" == null ")}clear(){this.blinkOf(),this.show();for(var t=0;t<this.cols;t++)for(var e=0;e<this.rows;e++)this.cellel[e][t].innerHTML="&nbsp;";this.x=0,this.y=0}nl(){this.blinkOf(),this.show(),this.x=0,this.y++,this.y>=this.rows&&(this.y=this.rows-1),this.__int_scrollDown()}__int_nl(){this.x=0,this.y++,this.y>=this.rows&&(this.__int_scrollDown(),this.y=this.rows-1)}writeln(t){this.blinkOf(),this.show(),console.log("writeln"+t);for(var e=0;e<t.length;e++){var i=t.substr(e,1);this.__int_write_direct_ch(i)}this.__int_nl()}write(t){this.blinkOf(),this.show();for(var e=0;e<t.length;e++){var i=t.substr(e,1);this.__int_write_direct_ch(i)}}__int_write_direct_ch(t){var e=this.cellel[this.y][this.x];null!=e?(e.innerHTML=" "==t?"&nbsp":t,this.reverse?(e.style.backgroundColor=this.outColors.txtColor,e.style.color=this.outColors.txtBgColor):(e.style.color=this.outColors.txtColor,e.style.backgroundColor=void 0),this.x++,this.x>=this.cols&&(this.x=0,this.__int_nl())):console.log("cell at "+this.x+","+this.y+" == null ")}writec(t){this.blinkOf(),this.show(),"\n"!=t?this.__int_write_direct_ch(t):this.__int_nl()}control(t,e){this.blinkOf(),this.show(),16==t?this.outColors.txtColor=this.colors[e]:17==t?this.outColors.txtBgColor=this.colors[e]:24==t?this.clear():25==t?this.hide():64==t?this.reverse=!1:65==t?this.reverse=!0:this.__int_write_direct_ch("?")}__int_scrollDown(){for(var t=0;t<this.cols;t++)for(var e=0;e<this.rows-1;e++){var i=this.cellel[e][t],s=this.cellel[e+1][t];i.innerHTML=s.innerHTML,i.style.color=s.style.color,i.style.backgroundColor=s.style.backgroundColor}var r=this.rows-1;for(t=0;t<this.cols;t++)(i=this.cellel[r][t]).innerHTML="&nbsp;",this.reverse?(i.style.backgroundColor=this.outColors.txtColor,i.style.color="rgba(0,255,0,0.0)"):(i.style.color=this.outColors.txtColor,i.style.backgroundColor=void 0)}},boot.m.simplewarning=class{constructor(t){if(!t)throw"sys expected";this.sys=t,this.key=t.SIG+"__LSConfirmed",this.warningOngoing=!1,console.log("simplewarning initialized"),t.notify=this}init(){}simpleWarning(){if(!this.warningOngoing){this.oldBGColor=document.body.style.backgroundColor,document.body.style.backgroundColor="#ffffff";var t=this;setTimeout((function(){document.body.style.backgroundColor=t.oldBGColor,t.warningOngoing=!1}),200)}}},boot.m.priv=class{constructor(t){if(!t)throw"sys expected";this.sys=t,this.key=t.SIG+"__LSConfirmed",this.verified=!1,this.denied=!1,console.log("PrivWarning initialized")}init(){}confirmLocalStorage(){return!(this.denied||"true"!=localStorage.getItem(this.key)&&(confirm("!! Do you allow "+this.sys.SIG+" to write to local browser storage !!\nThis is needed to simulate a local harddisk.\n If you do not agree, you can still use the system,\n but you won't be able to save any files, or session information.\n\nAll information will only be stored on the local storage,\n and will not be shared with any server, unless you will give explicit permission.\n\nThank you!")?(localStorage.setItem(this.key,"true"),0):(this.denied=!0,1)))}},boot.m.mutedinput=class{constructor(t){}init(){}getKey(){return null}setInputHandler(t,e){}},boot.m.domelinput=class{constructor(t){if(!t)throw"sys expected";this.sys=t,this.evtQueueKeyPress=[],this.handler=null,this.prefix=""}init(){this.init.inputElement,this.target=document.body}getKey(){return this.handler||0==this.evtQueueKeyPress.length?null:this.evtQueueKeyPress.shift()}setInputHandler(t,e){this.handler=t,this.prefix=e;var i=this.evtQueueKeyPress,s=(this.sys.out,this.handler);e=this.prefix,this.target.inputMode="text",this.target.addEventListener("keydown",(t=>{var r={type:"keydown",key:t.key,keyLabel:t.key};t.key.length>1&&(r.key=null,r.keyLabel=t.key,"Enter"==t.key&&(r.key="\n")),s?s[e+"KeyHandler"](r):i.push(r)}))}},boot.m.htmlwrapper=class{constructor(t){if(!t)throw"sys expected";this.sys=t,this.node=document.body,document.body.id="top",this.isAttr=!1}init(){}execute(t){var e=t[0];console.log("execute",e);var i=e.htmlHandle;if(i?this.setnode(i):this.isAttr=!1,null!=this.node)if(0==this.isAttr)if(e.htmlAppend){var s=document.createElement("span");s.innerHTML=e.htmlValue;const t=s.childNodes;var r=[];for(let e=0;e<t.length;e++)r.push(t[e]);for(let t=0;t<r.length;t++)this.node.appendChild(r[t]);s=null}else{if("top"==this.node.id)return void console.log("Cannot replace body code. it would crash the console!");this.node.innerHTML=e.htmlValue}else{var o=this.node.attributes.getNamedItem(this.attrName);if(null==o)return void console.log("Attr '"+this.attrName+"' not found on html node "+this.node.id+"!");o=o.nodeValue,e.htmlAppend?o+=e.htmlValue:o=e.htmlValue,this.node.setAttribute(this.attrName,o)}else console.log("invalid html root")}setnode(t){if(console.log("setnode",t),this.isAttr=!1,".."==t)this.node=this.node.parentNode;else{var e=t.split("."),i=null,s=null;if(e.length>1?(s=e[0],i=e[1]):s=t,""!=s){var r=document.getElementById(s);if(!r)return void console.log("could not find",t);this.node=r}""!=i&&null!=i&&(this.isAttr=!0,this.attrName=i)}}},boot.m.basic=class{constructor(t){this.apps=[],this.sys=t}init(){var t=this.sys,e=t.out,i=t.m.htmlwrapper;this.out=e,t.staticTarget?this.worker=new Worker("basicworker.js"):this.worker=new Worker("sys/modules/basic/worker/workerwrapper.js"),this.worker.onmessage=function(s){var r=s.data.message,o=s.data.type;if("syslog"==o)t.log("BWSYS:",s.data.message);else if("syserr"==o)t.logerr("BWERR:",s.data.message);else if("write"==o)for(var l=0;l<r.length;l++)e.write(r[l]);else if("writeln"==o)for(l=0;l<r.length;l++)e.writeln(r[l]);else"writec"==o?e.writec(r):"control"==o?e.control(r):"control2"==o?e.control(r.c,r.d):"html"==o?i.execute(r):"htmlnode"==o&&i.setnode(r[0].value)}}loadApp(t){this.sys.log("BSYS:","Load",t);var e={clazz:this,method:"loadedApp",data:null};this.sys.m.qfs.loadFile(t,e)}loadedApp(t){this.sys.log("BSYS:","Loaded",t.args.url),this.worker.postMessage({type:"loadpgm",pgmData:t.data.data,QPath:t.args.qpath})}setInput(t){this.sys.log("BSYS: Setting input on BAPPS.."),this.input=t,this.input.setInputHandler(this,"input")}inputKeyHandler(t){this.worker.postMessage(t)}},boot.m.sfs=class{constructor(t){if(!t)throw"sys expected";this.initialized=!1,this.sys=t,this.prefix=t.SIG+"__"}init(){this.initialize()}initialize(){this.currentDisk="SYS",this.initialized=!0}ready(){return this.initialized}getEmptyDirStructure(t){return{files:[],title:"null"}}getDir(){if(!this.initialized)return getEmptyDirStructure(null);var t=this.prefix+""+this.currentDisk+"_dir",e=sessionStorage.getItem(t),i=JSON.parse(e),s=i.title;if(!e)return{files:[],title:s};i.title=s,i.free=32-i.files.length;for(var r=-1;;){for(var o=0;o<i.files.length;o++)if(null==i.files[o]){r=o;break}if(!(r>-1))break;i.files.splice(r,1),r=-1}return i}setDir(t){if(0!=this.privacy.confirmLocalStorage()&&this.initialized){var e=this.prefix+""+this.currentDisk+"_dir";sessionStorage.setItem(e,JSON.stringify(t))}}existsFile(t){if(!this.initialized)return!1;for(var e=this.getDir(),i=-1,s=0;s<e.files.length;s++)if(e.files[s].fname==t){i=s;break}return i>-1}removeFromDir(t){if(this.initialized){for(var e=this.getDir(),i=-1,s=0;s<e.files.length;s++)if(e.files[s].fname==t){i=s;break}i>-1&&e.files.splice(s,1),this.setDir(e)}}updateDir(t,e,i){if(this.initialized){for(var s=this.getDir(),r=-1,o=0;o<s.files.length;o++)if(s.files[o].fname==t){r=o;break}r>-1?(s.files[o].size=e,s.files[o].type=i):s.files.push({fname:t,size:e,type:i}),this.setDir(s)}}saveFile(t,e,i,s){if(!this.initialized)return!1;if(0==this.privacy.confirmLocalStorage())return!1;var r=t;t.length>32&&(r=t.substr(0,32));var o=this.prefix+""+this.currentDisk+"_"+r,l=JSON.stringify({type:i,data:e});return sessionStorage.setItem(o,l),this.updateDir(r,s,i),!0}loadFile(t){if(!this.initialized)return null;var e=this.prefix+""+this.currentDisk+"_"+t,i=sessionStorage.getItem(e);return JSON.parse(i)}deleteFile(t){if(!this.existsFile(t))return"no such file";try{this.removeFromDir(t),this._removeFile(t)}catch(t){return"unexpected"}return"ok"}_removeFile(t){var e=this.prefix+""+this.currentDisk+"_"+t;sessionStorage.removeItem(e)}formatDisk(){for(var t=this.getDir(),e=0;e<t.files.length;e++){var i=t.files[e].fname;this._removeFile(i)}t.files=[],t.title="Empty",this.setDir()}getFullDisk(){if(!this.initialized){var t={dir:e=this.getDir(),content:[]};return JSON.stringify(t)}for(var e=this.getDir(),i=[],s=0;s<e.files.length;s++){var r=e.files[s].fname,o=this.prefix+""+this.currentDisk+"_"+r,l=sessionStorage.getItem(o);i.push({fname:r,content:l})}t={dir:e,content:i};var n=JSON.stringify(t);return console.log(n),n}},boot.m.lfs=class{constructor(t){if(!t)throw"sys expected";this.initialized=!1,this.sys=t,this.prefix=t.SIG+"__",console.log(t)}init(){this.initialize()}initialize(){this.privacy=this.sys.m.priv,this.disks=[],this.currentDisk=null;var t=localStorage.getItem(this.prefix+"disks_list");if(null==t){var e="0001";this.disks=[e],this.currentDisk=e,this.lastDisk=1,1==this.privacy.confirmLocalStorage()&&(localStorage.setItem(this.prefix+"disks_list",JSON.stringify(this.disks)),localStorage.setItem(this.prefix+"0001_dir",JSON.stringify({files:[],title:"Default",readOnly:!1})),localStorage.setItem(this.prefix+"disk_current",e))}else{this.disks=JSON.parse(t),this.currentDisk=localStorage.getItem(this.prefix+"disk_current");for(var i=-1,s=0;s<this.disks.length;s++)parseInt(this.disks[s])>i&&(i=parseInt(this.disks[s]));this.lastDisk=i}this.initialized=!0}isASynch(){return!1}selectDisk(t){this.currentDisk=t,1==this.privacy.confirmLocalStorage()&&localStorage.setItem(this.prefix+"disk_current",t)}ready(){return this.initialized}getDisks(){if(!this.initialized)return[];var t=this.prefix+"disks_list",e=localStorage.getItem(t);return JSON.parse(e)}getEmptyDirStructure(t){return{files:[],title:"null"}}getDir(){if(!this.initialized)return getEmptyDirStructure(null);var t=this.prefix+""+this.currentDisk+"_dir",e=localStorage.getItem(t),i=JSON.parse(e),s=i.title;if(!e)return{files:[],title:s};i.title=s,i.free=32-i.files.length;for(var r=-1;;){for(var o=0;o<i.files.length;o++)if(null==i.files[o]){r=o;break}if(!(r>-1))break;i.files.splice(r,1),r=-1}return i}getSelectedDir(t){if(!this.initialized)return{files:[],title:"null"};var e=this.prefix+""+t+"_dir",i=localStorage.getItem(e),s=JSON.parse(i),r=s.title;return i?(s.title=r,s.free=32-s.files.length,s):{files:[],title:r}}setDir(t){if(this.initialized){var e=this.prefix+""+this.currentDisk+"_dir";1==this.privacy.confirmLocalStorage()&&localStorage.setItem(e,JSON.stringify(t))}}existsFile(t){if(!this.initialized)return!1;for(var e=this.getDir(),i=-1,s=0;s<e.files.length;s++)if(e.files[s].fname==t){i=s;break}return i>-1}removeFromDir(t){if(this.initialized){for(var e=this.getDir(),i=-1,s=0;s<e.files.length;s++)if(e.files[s].fname==t){i=s;break}i>-1&&e.files.splice(s,1),this.setDir(e)}}updateDir(t,e,i){if(this.initialized){for(var s=this.getDir(),r=-1,o=0;o<s.files.length;o++)if(s.files[o].fname==t){r=o;break}r>-1?(s.files[o].size=e,s.files[o].type=i):s.files.push({fname:t,size:e,type:i}),this.setDir(s)}}saveFile(t,e,i,s){if(this.initialized){var r=t;t.length>32&&(r=t.substr(0,32)),r.startsWith("$/")&&(r=r.substr(2));var o=this.prefix+""+this.currentDisk+"_"+r,l=JSON.stringify({type:i,data:e});1==this.privacy.confirmLocalStorage()&&(localStorage.setItem(o,l),this.updateDir(r,s,i))}}loadJSONFile(t){if(!this.initialized)return null;var e=this.prefix+""+this.currentDisk+"_"+t,i=localStorage.getItem(e);return JSON.parse(i)}loadFile(t){if(!this.initialized)return null;var e=t;t.length>32&&(e=t.substr(0,32)),e.startsWith("$/")&&(e=e.substr(2));var i=this.prefix+""+this.currentDisk+"_"+e,s=localStorage.getItem(i);return JSON.parse(s)}deleteFile(t){if(!this.existsFile(t))return"no such file";try{this.removeFromDir(t),this._removeFile(t)}catch(t){return"unexpected"}return"ok"}_removeFile(t){var e=this.prefix+""+this.currentDisk+"_"+t;localStorage.removeItem(e)}formatDisk(){for(var t=this.getDir(),e=0;e<t.files.length;e++){var i=t.files[e].fname;this._removeFile(i)}t.files=[],t.title="Empty",this.setDir()}createDiskFromImage(t,e){this.createDiskFromImage2(t,e,!1)}createSysDiskFromImage(t){this.createDiskFromImage2("SYS",t,!0)}createDiskFromImage2(t,e,i){if(0!=this.privacy.confirmLocalStorage()){var s;i?s="1":(this.lastDisk++,s=""+this.lastDisk),s=s.padStart(4,"0");var r=e.dir,o=e.outtent,l=this.prefix+""+s+"_dir";localStorage.setItem(l,JSON.stringify(r));for(var n=0;n<o.length;n++){var a=o[n].fname;l=this.prefix+""+s+"_"+a,localStorage.setItem(l,o[n].outtent)}this.disks.push(s),localStorage.setItem(this.prefix+"disks_list",JSON.stringify(this.disks))}}createDisk(){if(0!=this.privacy.confirmLocalStorage()){this.getDisks(),this.lastDisk++;var t=""+this.lastDisk;t=t.padStart(4,"0");var e=this.getEmptyDirStructure("NEW DISK"),i=this.prefix+""+t+"_dir";localStorage.setItem(i,JSON.stringify(e)),this.disks.push(t),localStorage.setItem(this.prefix+"disks_list",JSON.stringify(this.disks))}}getFullDisk(){if(!this.initialized){var t={dir:e=this.getDir(),content:[]};return JSON.stringify(t)}for(var e=this.getDir(),i=[],s=0;s<e.files.length;s++){var r=e.files[s].fname,o=this.prefix+""+this.currentDisk+"_"+r,l=localStorage.getItem(o);i.push({fname:r,content:l})}t={dir:e,content:i};var n=JSON.stringify(t);return console.log(n),n}},boot.m.ramfs=class{constructor(t){if(!t)throw"sys expected";this.sys=t,this.files=[],this.data={}}init(){}isASynch(){return!1}ready(){return!0}getDir(){return this.files}exists(t){for(var e=this.getDir(),i=-1,s=0;s<e.length;s++)if(e[s].fname==t){i=s;break}return i>-1}saveFile(t,e,i,s){if(t.indexOf("/")>-1)throw{message:"saveFile: '"+t+"' - invalid path, RAMFS device only supports flatdir"};if(!this.exists(t)){var r={fname:t,type:i,size:s};this.data[t]={type:i,data:e},this.files.push(r)}}loadFile(t){return this.exists(t)?this.data[t]:null}deleteFile(t){if(!this.existsFile(t))return!1;try{for(var e=this.files,i=0;i<e.length;i++)if(e[i].fname==t){e[i]=void 0;break}this.data[t]=void 0}catch(e){throw{message:"deleteFile: '"+t+"' - "+e.message}}return!0}formatDisk(){this.files=[],this.data={}}},boot.m.script=class{constructor(t){if(!t)throw"sys expected";this.sys=t,this.files=[],this.data={}}init(){}isASynch(){return!1}ready(){return!0}exists(t){if(document.getElementById(t))return!0}saveFile(t,e,i,s){throw{message:"saveFile '"+t+"' - SCRIPTURL is readonly"}}loadFile(t){if(!this.exists(t))return null;for(var e=document.getElementById(t).innerText.split("\n"),i="",s=0;s<e.length;s++)""!=i&&(i+="\n"),i+=e[s].trim();return{type:"bas",data:i}}deleteFile(t){throw{message:"deleteFile '"+t+"' - SCRIPTURL is readonly"}}formatDisk(){throw{message:"formatDisk '"+fileName+"' - SCRIPTURL is readonly"}}},boot.m.qfs=class{constructor(t,e){if(!t)throw"sys expected";if(!e)throw"dependencies expected";this.dependencies=e,this.initialized=!1,this.sys=t,this.prefix=t.SIG+"__"}init(){this.initialize()}initialize(){this.fsList=[];for(var t=this.dependencies,e=0;e<t.length;e++){var i=t[e],s={token:i,fs:this.sys.m[i],prefix:i+"://"};this.fsList.push(s)}this.initialized=!0}ready(){return this.initialized}getFS(t){for(var e=this.fsList,i=0;i<e.length;i++){var s=e[i];if(t.startsWith(s.prefix))return s}return null}getLPath(t){var e=t.split("://");return e.length<2?null:e[1]}getDir(t){return!!this.initialized&&[]}existsFile(t){return this.initialized,!1}doCallBack(t,e){t.clazz?(t.data&&(e.cbData=t.data),t.clazz[t.method](e)):t(e)}saveFile(t,e,i,s,r){if(!this.initialized)return null;var o=this.getFS(t);if(!o)throw{message:t+" has unknown file system"};var l=this.getLPath(t);if(!l)throw{message:"QPath '"+t+"' has no local path"};if(!o.fs.isASynch()){var n=o.fs.saveFile(l,e,s,r),a={};a.qpath=t,a.type=s,a.length=r;var h={result:n,args:a};this.doCallBack(i,h)}return null}loadFile(t,e){if(!this.initialized)return null;var i=this.getFS(t);if(!i)throw{message:t+" has unknown file system"};var s=this.getLPath(t);if(!s)throw{message:"QPath '"+t+"' has no local path"};if(!i.fs.isASynch()){var r={data:i.fs.loadFile(s),cbData:e.data,args:{qpath:t}};e.clazz[e.method](r)}return null}deleteFile(t){return this.existsFile(fileName)?"error":"no such file"}formatDisk(t){return this.existsFile(fileName)?"error":"no such file"}},boot.dep.qfs=["ramfs","lfs","sfs","script"],boot.initSimpleLogging();for(var e=Object.getOwnPropertyNames(boot.m),i=0;i<e.length;i++)console.log("construct "+e[i]),boot.m[e[i]]=new boot.m[e[i]](t,boot.dep[e[i]]);for(t.init.queuedMessages=t.nulcon,t.init.conStyle=boot.conStyle,t.init.displayMode=boot.displayMode,boot.out=boot.m.tablecon,t.out=boot.m.tablecon,t.m=boot.m,i=0;i<e.length;i++)console.log("init "+e[i]),boot.m[e[i]].init();try{var s=boot.rootScript.getAttribute("basScript");null==s&&(s="autorun"),boot.onReady="script://"+s}catch(t){throw alert("HALT: Boot-Onready Handler not found!!"),"HALT - Neither root-script-attribute 'basScript' or constant 'BOOT_ONREADY' defined."}t.nulcon=void 0,boot.input=boot.m.domelinput,console.log("boot.basic=",boot.basic),boot.m.basic.setInput(boot.input),boot.m.basic.loadApp(boot.onReady)})();
//# sourceMappingURL=basicloader.js.map